<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>MyBatis | thr's blog</title><meta name="author" content="thr"><meta name="copyright" content="thr"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="一、MyBatis1. MyBatis 简介1.1 MyBatis 历史 MyBatis 本是 Apache 的一个开源项目 iBatis，2010年这个项目由 Apache Software Foundation 迁移到了 Google Code，并且改名为 MyBatis 。代码于2013年11月迁移 Github。  iBatis 一词来源于 “internet” 和 “abatis” 的组">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis">
<meta property="og:url" content="https://tangsmallrong.github.io/2023/11/18/MyBatis/index.html">
<meta property="og:site_name" content="thr&#39;s blog">
<meta property="og:description" content="一、MyBatis1. MyBatis 简介1.1 MyBatis 历史 MyBatis 本是 Apache 的一个开源项目 iBatis，2010年这个项目由 Apache Software Foundation 迁移到了 Google Code，并且改名为 MyBatis 。代码于2013年11月迁移 Github。  iBatis 一词来源于 “internet” 和 “abatis” 的组">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://tangsmallrong.github.io/img/avatar.jpg">
<meta property="article:published_time" content="2023-11-18T02:41:20.000Z">
<meta property="article:modified_time" content="2023-11-18T09:00:25.104Z">
<meta property="article:author" content="thr">
<meta property="article:tag" content="mybatis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://tangsmallrong.github.io/img/avatar.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://tangsmallrong.github.io/2023/11/18/MyBatis/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: thr","link":"链接: ","source":"来源: thr's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MyBatis',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-18 17:00:25'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="thr's blog"><span class="site-name">thr's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">MyBatis</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-18T02:41:20.000Z" title="发表于 2023-11-18 10:41:20">2023-11-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-18T09:00:25.104Z" title="更新于 2023-11-18 17:00:25">2023-11-18</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/SSM/">SSM</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">20.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>88分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MyBatis"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="一、MyBatis"><a href="#一、MyBatis" class="headerlink" title="一、MyBatis"></a>一、MyBatis</h2><h3 id="1-MyBatis-简介"><a href="#1-MyBatis-简介" class="headerlink" title="1. MyBatis 简介"></a>1. MyBatis 简介</h3><h4 id="1-1-MyBatis-历史"><a href="#1-1-MyBatis-历史" class="headerlink" title="1.1 MyBatis 历史"></a>1.1 MyBatis 历史</h4><ul>
<li><p><strong>MyBatis</strong> 本是 Apache 的一个开源项目 <strong>iBatis</strong>，2010年这个项目由 Apache Software Foundation 迁移到了 Google Code，并且改名为 MyBatis 。代码于2013年11月迁移 Github。</p>
</li>
<li><p>iBatis 一词来源于 “internet” 和 “abatis” 的组合，是一个<strong>基于Java的持久层框架</strong>。iBatis 提供的持久层框架包括 <strong>SQL Maps</strong>(sql 映射) 和 <strong>Data Access Objects</strong>（DAO）。</p>
</li>
</ul>
<h4 id="1-2-MyBatis-特性"><a href="#1-2-MyBatis-特性" class="headerlink" title="1.2 MyBatis 特性"></a>1.2 MyBatis 特性</h4><ul>
<li>MyBatis 是支持定制化 SQL、存储过程以及高级映射的优秀的持久层框架</li>
<li>MyBatis <strong>避免</strong>了几乎所有的 JDBC 代码和手动设置参数以及获取结果集</li>
<li>MyBatis可以使用简单的<strong>XML</strong>或<strong>注解</strong>用于配置和原始映射，将接口和 Java 的 <strong>POJO（Plain Old Java Objects，普通的 Java 对象）</strong>映射成数据库中的记录</li>
<li>MyBatis 是一个 <strong>半自动的ORM</strong>（Object Relation Mapping 对象关系[关系型数据库]映射）框架</li>
</ul>
<h4 id="1-3-MyBatis-下载"><a href="#1-3-MyBatis-下载" class="headerlink" title="1.3 MyBatis 下载"></a>1.3 MyBatis 下载</h4><ul>
<li>下载地址：<a target="_blank" rel="noopener" href="https://github.com/mybatis/mybatis-3">https://github.com/mybatis/mybatis-3</a></li>
</ul>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1669881015705.png" alt="图1.3.1"></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1670076569225.png" alt="图1.3.2"></p>
<h4 id="1-4-和其它的持久层技术对比"><a href="#1-4-和其它的持久层技术对比" class="headerlink" title="1.4 和其它的持久层技术对比"></a>1.4 和其它的持久层技术对比</h4><ul>
<li><strong>JDBC</strong><ul>
<li>SQL 夹杂在Java代码中耦合度高，导致硬编码内伤</li>
<li>维护不易且实际开发需求中 SQL 有变化，频繁修改的情况多见</li>
<li>代码冗长，开发效率低</li>
</ul>
</li>
<li><strong>Hibernate 和 JPA</strong><ul>
<li>操作简便，开发效率高</li>
<li>程序中的长难复杂 SQL 需要绕过框架</li>
<li>内部自动生产的 SQL，不容易做特殊优化</li>
<li>基于全映射的全自动框架，大量字段的 POJO 进行部分映射时比较困难</li>
<li>反射操作太多，导致数据库性能下降</li>
</ul>
</li>
<li><strong>MyBatis</strong><ul>
<li>轻量级，性能出色</li>
<li>SQL 和 Java 编码分开，功能边界清晰。<strong>Java代码专注业务、SQL语句专注数据</strong></li>
<li>开发效率稍逊于HIbernate，但是完全能够接受</li>
</ul>
</li>
</ul>
<h3 id="2-搭建-MyBatis"><a href="#2-搭建-MyBatis" class="headerlink" title="2. 搭建 MyBatis"></a>2. 搭建 MyBatis</h3><h4 id="2-1-开发环境"><a href="#2-1-开发环境" class="headerlink" title="2.1 开发环境"></a>2.1 开发环境</h4><ul>
<li>IDE：idea 2020.3.2</li>
<li>构建工具：maven 3.6.1</li>
<li>MySQL版本：MySQL 5.7.19</li>
<li>MyBatis版本：MyBatis 3.5.10</li>
</ul>
<blockquote>
<p>MySQL 不同版本注意事项</p>
<p>1、 驱动类 driver-class-name</p>
<p>MySQL 5 版本使用 jdbc5 驱动，驱动类使用：com.mysql.jdbc.Driver</p>
<p>MySQL 8 版本使用 jdbc8 驱动，驱动类使用：com.mysql.cj.jdbc.Driver</p>
<p>2、连接地址 url</p>
<p>MySQL 5 版本的 url：</p>
<p>jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;ssm</p>
<p>MySQL 8 版本的 url：</p>
<p>jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;ssm?serverTimezone&#x3D;UTC</p>
<p>否则报错</p>
</blockquote>
<h4 id="2-2-创建-maven-工程"><a href="#2-2-创建-maven-工程" class="headerlink" title="2.2 创建 maven 工程"></a>2.2 创建 maven 工程</h4><p>（1）empty project?然后直接新建模块(module)?</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1670113569083.png" alt="图2.2.1"></p>
<p>（2）<strong>打包方式 –&gt; jar</strong>(在 pom.xml 中)</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1670113654328.png" alt="图2.2.2"></p>
<p>（3）导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- Mybatis核心 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- junit测试 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- MySQL驱动 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--因为我的maver库李MySQL版本为5.1.3所以我的版本号为5.1.3 根据自身版本修改--&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（4）创建数据库和表</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1670114147444.png" alt="图2.2.3"></p>
<p>（5）创建对应的实体类</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1670114414801.png" alt="图2.2.4"></p>
<h4 id="2-3-创建-MyBatis-的核心配置文件夹"><a href="#2-3-创建-MyBatis-的核心配置文件夹" class="headerlink" title="2.3 创建 MyBatis 的核心配置文件夹"></a>2.3 创建 MyBatis 的核心配置文件夹</h4><blockquote>
<p>习惯上命名为 <strong>mybatis-config.xml</strong>，这个文件名仅仅只是建议，并非强制要求。将来整合Spring之后，这个配置文件可以省略，所以操作时可以直接复制、粘贴。</p>
<p><strong>核心配置文件主要用于配置连接数据库的环境以及MyBatis的全局配置信息</strong>(设置如何连接数据库，而 MyBatis 的映射文件是设置如何操作数据库)</p>
<p>核心配置文件<strong>存放的位置是 src&#x2F;main&#x2F;resources 目录</strong>下</p>
<p>核心配置文件的内容可以从mybatis的官方文档中的 Getting Started 获得</p>
</blockquote>
<p>（1）官方文档中找配置文件里要写的内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置连接数据库的环境 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC<span class="symbol">&amp;amp;</span>useSSL=false<span class="symbol">&amp;amp;</span></span></span></span><br><span class="line"><span class="string"><span class="tag">                         				  useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;thr&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 引入 mybatis 的映射文件(映射文件里头写的是 sql 语句) </span></span><br><span class="line"><span class="comment">            通过读取核心配置文件来获取一个操作数据库的对象, 就可以直接执行 sql</span></span><br><span class="line"><span class="comment">            而 sql 语句在映射文件中, 所以要把映射文件配置到核心配置文件中, </span></span><br><span class="line"><span class="comment">            才可以通过加载核心配置文件去找到对应映射文件中的 sql 去执行以便实现效果 </span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1670336511797.png" alt="图2.3.1"></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672366373796.png" alt="图2.3.2"></p>
<h4 id="2-4-创建-mapper-接口"><a href="#2-4-创建-mapper-接口" class="headerlink" title="2.4 创建 mapper 接口"></a>2.4 创建 mapper 接口</h4><blockquote>
<p>MyBatis 中的 mapper 接口相当于以前的dao，但是区别在于，<strong>mapper仅仅是接口，我们不需要提供实现类</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thr.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    创建一个 mapper 接口(不用实现类) --&gt; mapper 接口中的一个方法对应映射文件的一个 sql 语句</span></span><br><span class="line"><span class="comment">    即可通过 mybatis 里头的一些功能来为它创建一个代理实现类</span></span><br><span class="line"><span class="comment">    当我们去调用接口里的方法时, 就可以直接对应一个 sql 语句并执行该语句</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    接口的起名规则: 我们所操作的表叫 t_user, 表当前对应的实体类叫 User 类,</span></span><br><span class="line"><span class="comment">                    所以当前的 mapper 接口就叫 UserMapper</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        实现添加功能的方法</span></span><br><span class="line"><span class="comment">        返回值: 增删改的返回值是固定的, 是受影响的行数, 故返回值设为 int 型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-5-创建-MyBatis-的映射文件"><a href="#2-5-创建-MyBatis-的映射文件" class="headerlink" title="2.5 创建 MyBatis 的映射文件"></a>2.5 创建 MyBatis 的映射文件</h4><p>&#x3D;&#x3D;关系梳理：&#x3D;&#x3D;</p>
<ul>
<li>&#x3D;&#x3D;一张表 ——&gt; 实体类 —-&gt; 对应当前的mapper接口—-&gt;对应一个映射文件&#x3D;&#x3D;</li>
<li>&#x3D;&#x3D;mapper接口中的方法 —&gt; 对应映射文件中的SQL语句&#x3D;&#x3D;</li>
</ul>
<p><strong>相关概念</strong>：<strong>ORM</strong>（<strong>O</strong>bject <strong>R</strong>elationship <strong>M</strong>apping）对象关系映射。</p>
<ul>
<li><p>对象：Java的实体类对象</p>
</li>
<li><p>关系：关系型数据库</p>
</li>
<li><p>映射：二者之间的对应关系</p>
</li>
</ul>
<table>
<thead>
<tr>
<th><strong>Java概念</strong></th>
<th><strong>数据库概念</strong></th>
</tr>
</thead>
<tbody><tr>
<td>类</td>
<td>表</td>
</tr>
<tr>
<td>属性</td>
<td>字段 &#x2F; 列</td>
</tr>
<tr>
<td>对象</td>
<td>记录 &#x2F; 行</td>
</tr>
</tbody></table>
<blockquote>
<p>1、映射文件的命名规则</p>
<p><strong>表所对应的实体类的类名+Mapper.xml</strong></p>
<p>例如：<strong>表</strong> t_user，映射的实体<strong>类</strong>为 User，所对应的<strong>映射文件</strong>为 UserMapper.xml，<strong>mapper 接口</strong>就叫 UserMapper</p>
<p><strong>因此一个映射文件对应一个实体类，对应一张表的操作</strong></p>
<p>MyBatis 映射文件用于编写 SQL，访问以及操作表中的数据</p>
<p>2、MyBatis 中可以面向接口操作数据，要保证两个一致</p>
<p>(1) mapper 接口的全类名和映射文件的命名空间（namespace）保持一致</p>
<p>(2) mapper 接口中方法的方法名和映射文件中编写SQL的标签的id属性保持一致</p>
<p>3、<strong>映射文件的内容同样可以从官方文档</strong>的 Getting Started 中获得（第四页）</p>
</blockquote>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1670385439032.png" alt="图2.5.1"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 映射文件里头写 sql 语句 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.thr.mybatis.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        mapper 接口和映射文件需保证两个一致：</span></span><br><span class="line"><span class="comment">        1、mapper 接口的 全类名 和 映射文件 的 namespace 保持一致</span></span><br><span class="line"><span class="comment">        2、mapper 接口中方法的方法名和映射文件中 sql 的 id属性 保持一致</span></span><br><span class="line"><span class="comment">            (建议把 mapper 接口中的方法复制一份到所写的对应的 sql 语句上方)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       保证两个一致后, 当我们调用 mapper 接口中的方法时, 就会根据当前 mapper 接口的全类名来找到咱们的映射文件,</span></span><br><span class="line"><span class="comment">        并且根据我们当前调用的方法的方法名来找到 sql 语句, 来获取这个标签中的 sql 并执行该 sql</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- int insertUser(); --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span>&gt;</span></span><br><span class="line">        insert into ssm.t_user values(null, &#x27;admin&#x27;, &#x27;123456&#x27;, 23, &#x27;男&#x27;, &#x27;1234@qq.com&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672383994244.png" alt="图2.5.2"></p>
<p>然后修改 mybatis-config.xml 中引入映射文件的路径 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入映射文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-6-通过-junit-测试功能"><a href="#2-6-通过-junit-测试功能" class="headerlink" title="2.6 通过 junit 测试功能"></a>2.6 通过 junit 测试功能</h4><p>（1）创建测试类</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672384450032.png" alt="图2.6.1"></p>
<ul>
<li>概念补充：<ul>
<li>&#x3D;&#x3D;SqlSession&#x3D;&#x3D;：代表<strong>Java程序和数据库之间的会话</strong>（HttpSession是Java程序和浏览器之间的会话）</li>
<li>&#x3D;&#x3D;SqlSessionFactory&#x3D;&#x3D;：是 “生产” SqlSession的 “工厂”</li>
<li>&#x3D;&#x3D;工厂模式&#x3D;&#x3D;：如果创建某一个对象，使用的<strong>过程基本固定</strong>，那么我们就<strong>可以把创建这个对象的相关代码封装到一个 “工厂类” 中</strong>，以后都<strong>使用这个工厂类来 “生产” 我们需要的对象</strong></li>
</ul>
</li>
<li>代码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thr.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 获取核心配置文件的输入流(读的功能), 注意此处的 Resources 是 org.apache.ibatis.io 里的</span></span><br><span class="line">        <span class="comment">// Resources.getResourceAsStream 用于获取当前的某一个文件(这里是核心配置文件)所对应的字节输入流</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 sqlSessionFactoryBuilder 对象</span></span><br><span class="line">        <span class="comment">// 用于构建一个 SqlSessionFactory, 而 SqlSessionFactory 是一个工厂对象, 使用的是工厂模式, 能够为我们提供 SqlSession 对象</span></span><br><span class="line">        <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 SqlSessionFactory 对象(通过 build 方法, 根据核心配置文件所对应的输入流来创建所对应的对象)</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 sql 的会话对象 SqlSession, 是 MyBatis 提供的操作数据库的对象</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">   	    <span class="comment">// 重点！(因为一个 mapper 接口不能直接创建对象, 所以通过代理模式创建当前 mapper 接口的代理实现类, 并且自动找到对应的 sql 语句去执行)</span></span><br><span class="line">        <span class="comment">// 获取 UserMapper 的代理实现类对象(代理模式 --&gt; 帮助创建了 mapper 接口的代理实现类), 返回当前接口的实现类的对象</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用 mapper 接口中的方法, 实现添加用户信息的功能</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> mapper.insertUser();</span><br><span class="line">        System.out.println(<span class="string">&quot;结果: &quot;</span> + result);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 手动提交事务</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭会话 sqlSession</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>优化(<strong>自动提交事务</strong>)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取核心配置文件的输入流</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取SqlSessionFactoryBuilder对象</span></span><br><span class="line"><span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取SqlSessionFactory对象</span></span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">build</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取SQL的会话对象SqlSession()不会自动提交事务,是MyBatis提供的操作数据库的对象</span></span><br><span class="line"><span class="comment">//SqlSession sqlSession = build.openSession();</span></span><br><span class="line"><span class="comment">//获取SQL的会话对象SqlSession(true)会自动提交事务,是MyBatis提供的操作数据库的对象</span></span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> build.openSession(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 重点！(因为一个 mapper 接口不能直接创建对象, 所以通过代理模式创建当前 mapper 接口的代理实现类, 并且自动找到对应的 sql 语句去执行)</span></span><br><span class="line"><span class="comment">// 获取 UserMapper 的代理实现类对象(代理模式 --&gt; 帮助创建了 mapper 接口的代理实现类), 返回当前接口的实现类的对象</span></span><br><span class="line"><span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用 mapper 接口中的方法, 实现添加用户信息的功能</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> mapper.insertUser();</span><br><span class="line">System.out.println(<span class="string">&quot;结果: &quot;</span> + result);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        //演示不用 mapper 接口时(用的不多)</span></span><br><span class="line"><span class="comment">//        // 通过 sql 语句的唯一标识找到 sql 并执行, 唯一标识是 namespace.sqlId</span></span><br><span class="line"><span class="comment">//        int result1 = sqlSession.insert(&quot;com.thr.mybatis.mapper.UserMapper.insertUser&quot;);</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;结果:&quot; + result1);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭会话 sqlSession</span></span><br><span class="line">sqlSession.close();</span><br></pre></td></tr></table></figure></li>
</ul>
<p>（2）测试</p>
<ul>
<li><p>SQLyog 中右键点击表名，在 更多表操作中选择 <strong>截断表</strong></p>
<blockquote>
<p><strong>截断和清空的区别</strong>：</p>
<p>清空：把表中的数据删除</p>
<p>截断：其底层是先将表删掉，再重新创建一个一模一样的表，故 id 会从一开始自增 (截断很危险，其不支持事务，执行了不能回滚)</p>
</blockquote>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672415508054.png" alt="图2.6.2"></p>
</li>
<li><p>执行成功</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672415765414.png" alt="图2.6.3"></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672415752389.png" alt="图2.6.4"></p>
</li>
</ul>
<h4 id="2-7-加入-log4j-日志功能"><a href="#2-7-加入-log4j-日志功能" class="headerlink" title="2.7 加入 log4j 日志功能"></a>2.7 加入 log4j 日志功能</h4><ul>
<li><p><strong>加入依赖</strong>，在 pom.xml 里添加配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- log4j日志 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>加入 log4j(日志框架) 的配置文件</strong></p>
<blockquote>
<p>log4j 的配置文件为 <strong>log4j.xml</strong>，存放位置是 <strong>src&#x2F;main&#x2F;resources</strong> 目录下</p>
</blockquote>
<p>注：报错提示 URI 未注册 可以不用管 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">log4j</span>:configuration <span class="keyword">SYSTEM</span> <span class="string">&quot;log4j.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">log4j:configuration</span> <span class="attr">xmlns:log4j</span>=<span class="string">&quot;http://jakarta.apache.org/log4j/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Encoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ConversionPattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%-5p %d&#123;MM-dd HH:mm:ss,SSS&#125; %m (%F:%L) \n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.ibatis&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">log4j:configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>日志的级别</strong></p>
<p>FATAL(致命) &gt; ERROR(错误) &gt; WARN(警告) &gt; INFO(信息) &gt; DEBUG(调试) </p>
<p>从左到右打印的内容越来越详细，故当我们选择了一个级别后，打印的是大于等于当前这个日志级别的日志信息(我们这里选的是 debug)</p>
</blockquote>
</li>
<li><p>运行结果如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DEBUG <span class="number">12</span>-<span class="number">31</span> <span class="number">00</span>:08:<span class="number">52</span>,<span class="number">243</span> ==&gt;  Preparing: insert into ssm.t_user <span class="title function_">values</span><span class="params">(<span class="literal">null</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="number">23</span>, <span class="string">&#x27;男&#x27;</span>, <span class="string">&#x27;1234@qq.com&#x27;</span>)</span> (BaseJdbcLogger.java:<span class="number">137</span>) </span><br><span class="line">DEBUG <span class="number">12</span>-<span class="number">31</span> <span class="number">00</span>:08:<span class="number">52</span>,<span class="number">281</span> ==&gt; Parameters:  (BaseJdbcLogger.java:<span class="number">137</span>) </span><br><span class="line">DEBUG <span class="number">12</span>-<span class="number">31</span> <span class="number">00</span>:08:<span class="number">52</span>,<span class="number">293</span> &lt;==    Updates: <span class="number">1</span> (BaseJdbcLogger.java:<span class="number">137</span>) </span><br><span class="line">结果: <span class="number">1</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="3-MyBatis-的-增-删改查"><a href="#3-MyBatis-的-增-删改查" class="headerlink" title="3. MyBatis 的(增)删改查"></a>3. MyBatis 的(增)删改查</h3><h4 id="3-1-创建工具类"><a href="#3-1-创建工具类" class="headerlink" title="3.1 创建工具类"></a>3.1 创建工具类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thr.mybatis.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionUtil</span> &#123;</span><br><span class="line">    <span class="comment">// 静态方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">getSqlSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 获取核心配置文件的输入流(捕获异常 ctrl + alt + t, 选择第六个 try/catch)</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. 获取 sqlSessionFactoryBuilder 对象</span></span><br><span class="line">            <span class="type">SqlSessionFactoryBuilder</span> <span class="variable">sqlSessionFactoryBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. 获取 sqlSessionFactory 对象</span></span><br><span class="line">            <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> sqlSessionFactoryBuilder.build(is);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. 获取 sqlSession 对象(自动提交事务)</span></span><br><span class="line">            sqlSession = sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sqlSession;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-2-Update"><a href="#3-2-Update" class="headerlink" title="3.2 Update"></a>3.2 Update</h4><ul>
<li><p><strong>在 mapper 接口中创建方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thr.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加用户信息</span></span><br><span class="line"><span class="comment">     * 返回值: 增删改的返回值是固定的, 是受影响的行数, 故返回值设为 int 型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在映射文件中写对应的 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.thr.mybatis.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- int insertUser(); --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span>&gt;</span></span><br><span class="line">        insert into ssm.t_user values(null, &#x27;admin&#x27;, &#x27;123456&#x27;, 23, &#x27;男&#x27;, &#x27;1234@qq.com&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- void updateUser(); --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span>&gt;</span></span><br><span class="line">        update ssm.t_user set username=&#x27;root&#x27;, password=&#x27;123&#x27; where id = 3</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 修改用户信息(用工具类实现)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 通过工具类先获取 sqlSession 对象</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 获取 mapper 接口的代理实现类对象, 直接调用接口中的方法即可</span></span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    mapper.updateUser();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 关闭 sqlSession</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-3-Delete"><a href="#3-3-Delete" class="headerlink" title="3.3 Delete"></a>3.3 Delete</h4><ul>
<li><p><strong>在 mapper 接口中创建方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在映射文件中写对应的 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- void deleteUser(); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span>&gt;</span></span><br><span class="line">    delete from ssm.t_user where id = 4</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 删除用户信息(用工具类实现)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line"></span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    mapper.deleteUser();</span><br><span class="line"></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-4-Retrieve"><a href="#3-4-Retrieve" class="headerlink" title="3.4 Retrieve"></a>3.4 Retrieve</h4><p>（1）&#x3D;&#x3D;查询单个用户信息(根据用户 id)&#x3D;&#x3D;</p>
<ul>
<li><p><strong>在 mapper 接口中创建方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据 id 查询用户信息</span></span><br><span class="line"><span class="comment"> * 返回一个对象(只查询一条用户信息)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">User <span class="title function_">getUserById</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在映射文件中写对应的 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 由于返回值是一个对象, 所以要写 resultType/resultMap,</span></span><br><span class="line"><span class="comment">         因为当前的字段名和属性名完全相同, 故此处直接选 resultType 即可</span></span><br><span class="line"><span class="comment">           resultType: 设置结果类型, 即查询的数据要转换为的 java 类型(此处要写全类名)</span></span><br><span class="line"><span class="comment">           resultMap: 自定义映射, 处理多对一或一对多的映射关系</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- User getUserById(); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.thr.mybatis.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    select * from ssm.t_user where id = 1</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>此处若没写 resultType，测试时会报错如下：</p>
<p>报错信息：<strong>A query was run and no Result Maps</strong> were found for the Mapped Statement ‘com.thr.mybatis.mapper.UserMapper.getUserById’. </p>
<p> It’s likely that <strong>neither a Result Type nor a Result Map</strong> was specified.</p>
</blockquote>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 查询用户信息(用工具类实现)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetUserById</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line"></span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> mapper.getUserById();</span><br><span class="line">    System.out.println(user);</span><br><span class="line">    <span class="comment">// 结果: User&#123;id=1, username=&#x27;admin&#x27;, password=&#x27;123456&#x27;, age=23, gender=&#x27;男&#x27;, email=&#x27;1234@qq.com&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>（2）&#x3D;&#x3D;查询所有用户信息&#x3D;&#x3D;</p>
<ul>
<li><p><strong>在 mapper 接口中创建方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有的用户信息</span></span><br><span class="line"><span class="comment"> * 返回一个对象集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">getAllUser</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在映射文件中写对应的 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 先转换为实体类对象后再放到集合里头 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- List&lt;User&gt; getAllUser(); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.thr.mybatis.pojo.User&quot;</span>&gt;</span></span><br><span class="line">    select * from ssm.t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 查询所有用户信息(用工具类实现)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetAllUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line"></span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    List&lt;User&gt; list = mapper.getAllUser();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环输出(这写法???!)</span></span><br><span class="line">    <span class="comment">// System.out::println 等价于 x -&gt; &#123; System.out.println(x) &#125;</span></span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 结果:</span></span><br><span class="line"><span class="comment">            User&#123;id=1, username=&#x27;admin&#x27;, password=&#x27;123456&#x27;, age=23, gender=&#x27;男&#x27;, email=&#x27;1234@qq.com&#x27;&#125;</span></span><br><span class="line"><span class="comment">            User&#123;id=2, username=&#x27;admin&#x27;, password=&#x27;123456&#x27;, age=23, gender=&#x27;男&#x27;, email=&#x27;1234@qq.com&#x27;&#125;</span></span><br><span class="line"><span class="comment">            User&#123;id=3, username=&#x27;root&#x27;, password=&#x27;123&#x27;, age=23, gender=&#x27;男&#x27;, email=&#x27;1234@qq.com&#x27;&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-MyBatis-的核心配置文件详解"><a href="#4-MyBatis-的核心配置文件详解" class="headerlink" title="4. MyBatis 的核心配置文件详解"></a>4. MyBatis 的核心配置文件详解</h3><h4 id="4-1-environments-标签"><a href="#4-1-environments-标签" class="headerlink" title="4.1 environments 标签"></a>4.1 environments 标签</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        environments: 配置连接数据库的环境</span></span><br><span class="line"><span class="comment">        属性: default: 设置默认使用的环境的 id (这里是 development 开发环境)</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            environment: 设置一个具体的连接数据库的环境</span></span><br><span class="line"><span class="comment">            属性: id: 设置环境的唯一标识(即不能重复)</span></span><br><span class="line"><span class="comment">            其拥有两个子标签:</span></span><br><span class="line"><span class="comment">                transactionManager: 事务管理器(设置数据库的管理方式)</span></span><br><span class="line"><span class="comment">                dataSource: 数据源</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置连接数据库的环境(此处是开发环境) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                 transactionManager: 设置事务管理器</span></span><br><span class="line"><span class="comment">                 属性: type: 设置事务管理的方式 type=&quot;JDBC/MANAGED&quot;</span></span><br><span class="line"><span class="comment">                            JDBC: 表示使用 JDBC 中原生的事务管理方式</span></span><br><span class="line"><span class="comment">                            MANAGED: 被管理, 例如 Spring 管理事务</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                dataSource: 设置数据源</span></span><br><span class="line"><span class="comment">                属性: type: 设置数据源的类型 type=&quot;POOLED/UNPOOLED/JNDI&quot;</span></span><br><span class="line"><span class="comment">                            POOLED: 表示使用数据库连接池(创建完连接后交给连接池管理, 下一次创建连接时直接从连接池里获取就行)</span></span><br><span class="line"><span class="comment">                            UNPOOLED: 表示不使用数据库连接池(每次获取都是重新获取/重新创建连接)</span></span><br><span class="line"><span class="comment">                            JNDI: 表示使用上下文中的数据源</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC<span class="symbol">&amp;amp;</span>useSSL=false<span class="symbol">&amp;amp;</span></span></span></span><br><span class="line"><span class="string"><span class="tag">                                        useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;thr&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置连接数据库的环境(此处是测试环境) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/ssm?serverTimezone=UTC<span class="symbol">&amp;amp;</span>useSSL=false<span class="symbol">&amp;amp;</span></span></span></span><br><span class="line"><span class="string"><span class="tag">                                        useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;thr&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-properties-标签"><a href="#4-2-properties-标签" class="headerlink" title="4.2 properties 标签"></a>4.2 properties 标签</h4><ul>
<li><p><strong>新建一个 properties 文件</strong></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672503199775.png" alt="图4.2.1"></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672503232875.png" alt="图4.2.2"></p>
</li>
<li><p><strong>编写配置文件</strong></p>
<blockquote>
<p>因为xml解析转移的原因，<code>&amp;amp;</code> 都改成 &amp; </p>
<p><strong>注意：useSSL&#x3D;false 需写在最前面！！！</strong></p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/ssm?useSSL=false&amp;serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=UTF-8</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">thr</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将 <strong>配置文件</strong>(jdbc.properties) <strong>引入到核心配置文件</strong>(mybatis-config.xml)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入 properties 文件, 此后就可以在当前文件中使用 $&#123;key&#125; 的方式访问 value --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="4-3-typeAliases-标签"><a href="#4-3-typeAliases-标签" class="headerlink" title="4.3 typeAliases 标签"></a>4.3 typeAliases 标签</h4><ul>
<li><p>配置文件里头进行配置</p>
<blockquote>
<p><strong>MyBatis 核心配置文件中的标签必须按照指定的顺序配置</strong>：            properties?,settings?,typeAliases?,typeHandlers?,         objectFactory?,objectWrapperFactory?,reflectorFactory?,plugins?,environments?,databaseIdProvider?,mappers?</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        MyBatis 核心配置文件中的标签必须按照指定的顺序配置:</span></span><br><span class="line"><span class="comment">            properties?,settings?,typeAliases?,typeHandlers?,</span></span><br><span class="line"><span class="comment">            objectFactory?,objectWrapperFactory?,reflectorFactory?,plugins?,</span></span><br><span class="line"><span class="comment">            environments?,databaseIdProvider?,mappers?</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 引入 properties 文件, 此后就可以在当前文件中使用 $&#123;key&#125; 的方式访问 value --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        typeAliases(这是一个复数标签): 设置类型别名</span></span><br><span class="line"><span class="comment">                 在 MyBatis 的范围中, 就可以使用别名表示一个具体的类型</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">           typeAlias: 为某个具体的类型设置一个别名</span></span><br><span class="line"><span class="comment">           属性:</span></span><br><span class="line"><span class="comment">                type: 设置需要起别名的类型</span></span><br><span class="line"><span class="comment">                alias: 设置某个类型的别名</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;typeAlias type=&quot;com.thr.mybatis.pojo.User&quot; alias=&quot;abc&quot;&gt;&lt;/typeAlias&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--若不设置 alias, 其默认别名为类名 User, 且不区分大小写 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;typeAlias type=&quot;com.thr.mybatis.pojo.User&quot;&gt;&lt;/typeAlias&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通过包来设置类型别名, 指定包下所有的类型将全部拥有默认的别名, 即类名且不区分大小写 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.thr.mybatis.pojo&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>映射文件里头修改，测试结果无误</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672505696179.png" alt="图4.3.1"></p>
</li>
</ul>
<h4 id="4-4-mappers-标签"><a href="#4-4-mappers-标签" class="headerlink" title="4.4 mappers 标签"></a>4.4 mappers 标签</h4><ul>
<li><p><strong>在 resources 下创建多级目录</strong>&#x3D;&#x3D;(注意使用 &#x2F; 分割，而不是 . 分割)&#x3D;&#x3D;</p>
<blockquote>
<p>因为 resources 下只能建目录不能建包</p>
</blockquote>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672506221981.png" alt="图4.4.1"></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672506279689.png" alt="图4.4.2"></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672507201101.png" alt="图4.4.3"></p>
</li>
<li><p><strong>在核心配置文件中引入映射文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;mapper resource=&quot;mappers/UserMapper.xml&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            以包的方式来引入映射文件, 但是必须满足两个条件:</span></span><br><span class="line"><span class="comment">                1. mapper接口 和 映射文件 所在的包必须一致</span></span><br><span class="line"><span class="comment">                2. mapper接口的名字 和 映射文件的名字 必须一致</span></span><br><span class="line"><span class="comment">      --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.thr.mybatis.mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注： <strong>改之后报错需要重构一下！！</strong></p>
<p>(如果报错Invalid bound statement的去右边maven打开clean一下)</p>
</blockquote>
</li>
<li><p>编译后可以在 target 目录下的 <strong>classes(主程序编译之后的类)</strong> 目录下看到<strong>它们实际上被加载到了同一个目录下</strong></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672506979687.png" alt="图4.4.4"></p>
</li>
</ul>
<h3 id="5-配置核心配置文件和映射文件模板"><a href="#5-配置核心配置文件和映射文件模板" class="headerlink" title="5. 配置核心配置文件和映射文件模板"></a>5. 配置核心配置文件和映射文件模板</h3><h4 id="5-1-配置模板"><a href="#5-1-配置模板" class="headerlink" title="5.1 配置模板"></a>5.1 配置模板</h4><p>（1）<strong>核心配置文件的模板</strong></p>
<ul>
<li><p>在 settings 里头配置</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672507887309.png" alt="图5.1.1"></p>
</li>
<li><p>之后右键就可以看到了</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672507932353.png" alt="图5.1.2"></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672507969288.png" alt="图5.1.3"></p>
</li>
</ul>
<p>（2）<strong>映射文件的模板</strong></p>
<ul>
<li><p>同理</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672508246355.png" alt="图5.1.4"></p>
</li>
</ul>
<h4 id="5-2-使用模板"><a href="#5-2-使用模板" class="headerlink" title="5.2 使用模板"></a>5.2 使用模板</h4><p>（1）创建新 Module</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672509931041.png" alt="图5.2.1"></p>
<p>（2）把原来的依赖和一些配置文件复制粘贴过来</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672510172270.png" alt="图5.2.1"></p>
<p>（3）搭建 MyBatis 框架</p>
<ul>
<li>利用前面创建的<strong>模板新建核心配置文件</strong></li>
<li>创建 <strong>mapper 接口</strong></li>
<li>创建 <strong>映射文件</strong>，在 namespace 里头写上接口的全类名</li>
</ul>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672510553461.png" alt="图5.2.2"></p>
<ul>
<li><p>创建<strong>主体类</strong> User (从之前那个工程里头复制过来即可)</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672510746378.png" alt="图5.2.3"></p>
</li>
<li><p><strong>将核心配置文件中别名和映射文件的全类名补充上</strong></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672557681099.png" alt="图5.2.4"></p>
</li>
</ul>
<h3 id="6-MyBatis-获取参数值的两种方式"><a href="#6-MyBatis-获取参数值的两种方式" class="headerlink" title="6. MyBatis 获取参数值的两种方式"></a>6. MyBatis 获取参数值的两种方式</h3><blockquote>
<p>MyBatis 获取参数值的两种方式：**${} 和 #{}**</p>
<p><strong>${} 的本质就是字符串拼接，#{} 的本质就是占位符赋值</strong>(后者比较常用，因为其可以自动添加单引号，还可以避免 sql 注入)</p>
<p><strong>${}</strong> 使用字符串拼接的方式拼接 sql，<strong>若为字符串类型或日期类型的字段进行赋值时，需要手动加单引号</strong></p>
<p><strong>#{}</strong> 使用占位符赋值的方式拼接 sql，此时为字符串类型或日期类型的字段进行赋值时，<strong>可以自动添加单引号</strong></p>
</blockquote>
<h4 id="6-1-单个字面量类型的参数"><a href="#6-1-单个字面量类型的参数" class="headerlink" title="6.1 单个字面量类型的参数"></a>6.1 单个字面量类型的参数</h4><blockquote>
<p>若mapper接口中的方法参数为单个的字面量类型</p>
<p>此时可以使用 <code>$&#123;&#125;</code> 和 <code>#&#123;&#125;</code> 以任意的名称获取参数的值，注意 <code>$&#123;&#125;</code> 需要<strong>手动加单引号</strong> </p>
</blockquote>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong>(根据用户名查询用户信息)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thr.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户名查询用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 单个字面量类型的参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回 User 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">getUserByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<blockquote>
<p>注：  </p>
<p>此处 #{} 的 {} 里写啥都没关系，只是最好见名知意</p>
<p>而此处若用 ${} 需在外头加单引号！！</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- User getUserByUsername(String username); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByUsername&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- select * from t_user where username = #&#123;username&#125; --&gt;</span></span><br><span class="line">    select * from t_user where username = &#x27;$&#123;username&#125;&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p><strong>表名爆红的解决方案</strong>：(好像没啥用，后面又改回来了，莫名其妙就好了)</p>
<p>File-&gt;Settings-&gt;Languages&amp;Frameworks-&gt;SQL Dialects-&gt;Global SQL Dialect设为None	</p>
</blockquote>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672556310152.png" alt="图6.1.1"></p>
<ul>
<li><p><strong>编写测试类</strong>（#{} 被当作占位符来解析）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thr.mybatis.test;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParameterTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetUserByUsername</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 获取 sqlSession 对象</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取 UserMapper 的代理实现类对象</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用 mapper 里头的方法</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> mapper.getUserByUsername(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-2-多个字面量类型的参数"><a href="#6-2-多个字面量类型的参数" class="headerlink" title="6.2 多个字面量类型的参数"></a>6.2 多个字面量类型的参数</h4><blockquote>
<p>若 mapper 接口中的<strong>方法参数为多个</strong>时，此时MyBatis<strong>会自动将这些参数放在一个 map集合 中</strong>，因此只需要通过<code>$&#123;&#125;</code>和<code>#&#123;&#125;</code><strong>访问map集合的键</strong>就可以<strong>获取相对应的值</strong>，注意<code>$&#123;&#125;</code>需要手动加单引号</p>
</blockquote>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">getUserByUsername</span><span class="params">(String username)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 验证登录(多个字面量类型的参数)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回 User 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">checkLogin</span><span class="params">(String username, String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- User checkLogin(String username, String password); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;checkLogin&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 此处可用 #&#123;arg0&#125; #&#123;arg1&#125; 或者 #&#123;param1&#125; #&#123;param2&#125; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- select * from t_user where username = #&#123;arg0&#125; and password = #&#123;arg1&#125; --&gt;</span></span><br><span class="line">    select * from t_user where username = &#x27;$&#123;param1&#125;&#x27; and password = &#x27;$&#123;param2&#125;&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>若写成 #{username} 和 #{password} 则会报错！！</p>
<p>报错提示：<strong>Available parameters are [arg1, arg0, param1, param2]</strong></p>
</blockquote>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCheckLogin</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> mapper.checkLogin(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-3-map-集合类型的参数"><a href="#6-3-map-集合类型的参数" class="headerlink" title="6.3 map 集合类型的参数"></a>6.3 map 集合类型的参数</h4><blockquote>
<p>若 mapper 接口中的方法需要的参数为多个时，此时可以<strong>手动创建 map 集合</strong>，将这些数据放在map中只需要通过 <code>$&#123;&#125;</code> 和 <code>#&#123;&#125;</code> <strong>访问map集合的键就可以获取相对应的值</strong>，注意 <code>$&#123;&#125;</code> 需要手动加单引号 </p>
</blockquote>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">getUserByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">    User <span class="title function_">checkLogin</span><span class="params">(String username, String password)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 验证登录(map 集合类型的参数)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map 集合里头存储用户名和密码, 用户名的键为 username, 密码的键为 password</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回 User 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">checkLoginByMap</span><span class="params">(Map&lt;String, Object&gt; map)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- User checkLoginByMap(Map&lt;String, Object&gt; map); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;checkLoginByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user where username = #&#123;username&#125; and password = #&#123;password&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCheckLoginByMap</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    map.put(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> mapper.checkLoginByMap(map);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-4-实体类类型的参数"><a href="#6-4-实体类类型的参数" class="headerlink" title="6.4 实体类类型的参数"></a>6.4 实体类类型的参数</h4><blockquote>
<p>若 mapper 接口中的方法<strong>参数为实体类对象</strong>时此时可以使用 <code>$&#123;&#125;</code> 和 <code>#&#123;&#125;</code>，通过<strong>访问实体类对象中的属性名获取属性值</strong>，注意 <code>$&#123;&#125;</code> 需要手动加单引号 </p>
</blockquote>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">getUserByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">    User <span class="title function_">checkLogin</span><span class="params">(String username, String password)</span>;</span><br><span class="line">    User <span class="title function_">checkLoginByMap</span><span class="params">(Map&lt;String, Object&gt; map)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加用户信息(实体类类型的参数)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user 参数是 user 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<blockquote>
<p><strong>属性和成员变量</strong>？</p>
<p>属性对应数据库对象的属性，成员变量是程序的变量。</p>
<p>到 springboot 的时候还要写代码把属性和成员变量对应起来</p>
<p>意思是：如果你的 <strong>getId 方法</strong>，return 的是你 name 的值，那我不管，我就认为你的这个 name 叫 <strong>id 属性</strong></p>
<p>不要将成员变量和方法搞混，我新建一个类，没有成员变量只有方法有没有问题？我将这个方法命名为get方法有没有问题？肯定都没问题呀</p>
<p>如果是个实体类，一般都是成员变量和getset方法一一对应的，但是总会出现一些非一般的情况。老师是给大家提个醒，别到时候一脸懵逼，哈哈哈</p>
<p>没有成员变量不影响你写一个getter&#x2F;setter方法</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- void insertUser(User user); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span>&gt;</span></span><br><span class="line">    insert into t_user values(null, #&#123;username&#125;, #&#123;password&#125;, #&#123;age&#125;, #&#123;gender&#125;, #&#123;email&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="number">33</span>, <span class="string">&quot;女&quot;</span>, <span class="string">&quot;123@qq.com&quot;</span>);</span><br><span class="line">    mapper.insertUser(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-5-使用-Param-标识参数"><a href="#6-5-使用-Param-标识参数" class="headerlink" title="6.5 使用 @Param 标识参数"></a>6.5 使用 @Param 标识参数</h4><blockquote>
<p>该方法较为常用，可以通过 <strong>@Param 注解</strong> 标识 mapper 接口中的方法参数，此时，会将这些<strong>参数放在map集合中</strong>（以 <strong>@Param 中的值为键，参数为值 或 以param1，param2，… 为键，参数为值</strong>），只需要通过<code>$&#123;&#125;</code>和<code>#&#123;&#125;</code><strong>访问map集合的键</strong>就可以获取相对应的值，注意<code>$&#123;&#125;</code>需要手动加单引号</p>
</blockquote>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">getUserByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">    User <span class="title function_">checkLogin</span><span class="params">(String username, String password)</span>;</span><br><span class="line">    User <span class="title function_">checkLoginByMap</span><span class="params">(Map&lt;String, Object&gt; map)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 验证登录(使用 <span class="doctag">@Param</span> 标识参数), 该方法比较常用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> username 用户名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回 User 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">checkLoginByParam</span><span class="params">(<span class="meta">@Param(value = &quot;username&quot;)</span> String username, <span class="meta">@Param(&quot;password&quot;)</span> String password)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- User checkLoginByParam(@Param(value = &quot;username&quot;) String username, @Param(&quot;password&quot;) String password); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;checkLoginByParam&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这里不仅可以用 @Param 的 value 属性值为键, 也可以用 param1, param2 为键(即 #&#123;param1&#125;) --&gt;</span></span><br><span class="line">    select * from t_user where username = #&#123;username&#125; and password = #&#123;password&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCheckLoginByParam</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> mapper.checkLoginByParam(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-6-总结"><a href="#6-6-总结" class="headerlink" title="6.6 总结"></a>6.6 总结</h4><ul>
<li>在使用过程中最好使用 <strong>实体类型的参数</strong> 和 <strong>@Param注解</strong> 来获取参数值(实际只要记住最后两种方法即可)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MyBatis 获取参数值的两种方式: #&#123;&#125; 和 $&#123;&#125;</span></span><br><span class="line"><span class="comment"> *  #&#123;&#125; 的本质是占位符赋值, $&#123;&#125; 的本质是字符串拼接</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 1. 若 mapper 接口方法的参数为单个的字面量类型</span></span><br><span class="line"><span class="comment"> *    此时可以通过 #&#123;&#125; 和 $&#123;&#125; 以任意的内容获取参数值, 一定要注意 $&#123;&#125; 的单引号问题</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 2. 若 mapper 接口方法的参数为多个的字面量类型</span></span><br><span class="line"><span class="comment"> *    此时 MyBatis 会将参数放在 map 集合中, 以两种方式存储数据</span></span><br><span class="line"><span class="comment"> *    a&gt; 以 arg0,arg1... 为键, 以参数为值</span></span><br><span class="line"><span class="comment"> *    b&gt; 以 param1,param2... 为键, 以参数为值</span></span><br><span class="line"><span class="comment"> *    因此, 只需要通过 #&#123;&#125; 和 $&#123;&#125; 访问 map 集合的键, 就可以获取相对应的值, 一定要注意 $&#123;&#125; 的单引号问题</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 3. 若 mapper 接口方法的参数为 map 集合类型的参数</span></span><br><span class="line"><span class="comment"> *    只需要通过 #&#123;&#125; 和 $&#123;&#125; 访问 map 集合的键, 就可以获取相对应的值, 一定要注意 $&#123;&#125; 的单引号问题</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 4. 若 mapper 接口方法的参数为实体类类型的参数</span></span><br><span class="line"><span class="comment"> *    只需要通过 #&#123;&#125; 和 $&#123;&#125; 访问实体类的属性名, 就可以获取相对应的属性值, 一定要注意 $&#123;&#125; 的单引号问题</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 5. 可以在 mapper 接口方法的参数上设置 <span class="doctag">@Param</span> 注解</span></span><br><span class="line"><span class="comment"> *    此时 MyBatis 会将这些参数放在 map 中, 以两种方式进行存储</span></span><br><span class="line"><span class="comment"> *    a&gt; 以 <span class="doctag">@Param</span> 注解的 value 属性值为键, 以参数为值</span></span><br><span class="line"><span class="comment"> *    b&gt; 以 param1, param2... 为键, 以参数为值</span></span><br><span class="line"><span class="comment"> *    只需要通过 #&#123;&#125; 和 $&#123;&#125; 访问 map 集合的键, 就可以获取相对应的值, 一定要注意 $&#123;&#125; 的单引号问题</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<h3 id="7-MyBatis-的各种查询功能"><a href="#7-MyBatis-的各种查询功能" class="headerlink" title="7. MyBatis 的各种查询功能"></a>7. MyBatis 的各种查询功能</h3><h4 id="7-1-查询一个实体类对象"><a href="#7-1-查询一个实体类对象" class="headerlink" title="7.1 查询一个实体类对象"></a>7.1 查询一个实体类对象</h4><blockquote>
<p>若 sql 语句<strong>查询的结果为多条</strong>时，一定<strong>不能以实体类类型作为方法的返回值</strong>，否则会抛出异常 TooManyResultsException</p>
<p>若 sql 语句<strong>查询的结果为1条</strong>时，此时<strong>可以使用实体类类型或 list 集合类型</strong>作为方法的返回值</p>
</blockquote>
<ul>
<li><p>创建 mapper 接口、映射文件以及测试类</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672652728402.png" alt="图7.1.1"></p>
</li>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thr.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SelectMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 id 查询用户信息(查询一个实体类对象)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id 用户 id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回一个实体类对象(此处是User 类的对象)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- User getUserById(@Param(&quot;id&quot;) Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetUserById</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">SelectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SelectMapper.class);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> mapper.getUserById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="7-2-查询一个-list-集合"><a href="#7-2-查询一个-list-集合" class="headerlink" title="7.2 查询一个 list 集合"></a>7.2 查询一个 list 集合</h4><ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SelectMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有的用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回一个 list 集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">getAllUser</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;User&gt; getAllUser(); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetAllUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">SelectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SelectMapper.class);</span><br><span class="line">    List&lt;User&gt; list = mapper.getAllUser();</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="7-3-查询单个数据"><a href="#7-3-查询单个数据" class="headerlink" title="7.3 查询单个数据"></a>7.3 查询单个数据</h4><ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SelectMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">getAllUser</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询用户的总数量(查询单个数据)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回用户数量(int 类型)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Integer <span class="title function_">getCount</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Integer getCount(); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        此处的 resultType 写 int/Integer 也行(不区分大小写)</span></span><br><span class="line"><span class="comment">        因为 MyBatis 中为 Java 中常用的类型设置了类型别名</span></span><br><span class="line"><span class="comment">        Integer: Integer, int</span></span><br><span class="line"><span class="comment">        int: _int, _integer</span></span><br><span class="line"><span class="comment">        String: string</span></span><br><span class="line"><span class="comment">        Map: map</span></span><br><span class="line"><span class="comment">        HashMap: hashmap   </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">    select count(*) from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetCount</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">SelectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SelectMapper.class);</span><br><span class="line">    <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> mapper.getCount();</span><br><span class="line">    System.out.println(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="7-4-查询一条数据为-map-集合"><a href="#7-4-查询一条数据为-map-集合" class="headerlink" title="7.4 查询一条数据为 map 集合"></a>7.4 查询一条数据为 map 集合</h4><ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SelectMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">getUserById</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">getAllUser</span><span class="params">()</span>;</span><br><span class="line">    Integer <span class="title function_">getCount</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过 id 查询用户信息, 以 map 集合来获取(查询一条数据为 map 集合)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回一个 map 集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Map&lt;String, Object&gt; <span class="title function_">getUserByIdToMap</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Map&lt;String, Object&gt; getUserByIdToMap(@Param(&quot;id&quot;) Integer id); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByIdToMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetUserByIdToMap</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">SelectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SelectMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出是以 字段名为键, 以 字段的值为值的 map(若某个字段的值为 null, 则不会被放在 map 里)</span></span><br><span class="line">    <span class="comment">// (map 集合中的 key 是无序的不可重复的, 其排序是按照 key 所在类重写的equals()和hashcode()来进行的)</span></span><br><span class="line">    <span class="comment">// &#123;password=123456, gender=男, id=1, age=23, email=12345@qq.com, username=admin&#125;</span></span><br><span class="line">    Map&lt;String, Object&gt; map = mapper.getUserByIdToMap(<span class="number">1</span>);</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="7-5-查询多条数据为-map-集合"><a href="#7-5-查询多条数据为-map-集合" class="headerlink" title="7.5 查询多条数据为 map 集合"></a>7.5 查询多条数据为 map 集合</h4><blockquote>
<p>若查询的数据有多条时，并且要将每条数据转换为 map 集合</p>
<p>此时有两种解决方案：（法一用的较多）</p>
<p>a&gt; 如果不确定返回几条结果，建议将 mapper 接口方法的<strong>返回值设置为泛型是 map 的 list</strong> 集合(即 List&lt;Map&lt;String, Object&gt;&gt; getAllUserToMap();)</p>
<p>b&gt; 可以将<strong>每条数据转换的 map 集合放在一个大的 map 中</strong>，但是必须要<strong>通过 @MapKey 注解将查询的某个字段的字作为大的 map 的键</strong>(json 格式？)</p>
<p>小技巧：</p>
<p>查询的结果有实体类，用实体类对象接收</p>
<p>查询的结果无实体类，用map集合方式接收</p>
</blockquote>
<p>（1）&#x3D;&#x3D;方法一：List&lt;Map&lt;&gt;&gt;&#x3D;&#x3D;</p>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询所有的用户信息为 map 集合(查询多条数据为 map 集合)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回一个存放着 每一条数据转换成的 map 集合 的 list 集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">getAllUserToMap</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<blockquote>
<p>注意此处的 resultType&#x3D;”map” ？？</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;Map&lt;String, Object&gt;&gt; getAllUserToMap(); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUserToMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAllUserToMap</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">SelectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SelectMapper.class);</span><br><span class="line"></span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; list = mapper.getAllUserToMap();</span><br><span class="line">    System.out.println(list);</span><br><span class="line">    <span class="comment">/*  运行结果:</span></span><br><span class="line"><span class="comment">            [&#123;password=123456, gender=男, id=1, age=23, email=12345@qq.com, username=admin&#125;,</span></span><br><span class="line"><span class="comment">            &#123;password=123456, gender=女, id=4, age=33, email=123@qq.com, username=root&#125;]</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>（2）&#x3D;&#x3D;方法二：@MapKey&#x3D;&#x3D;</p>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 采用注解方式</span></span><br><span class="line"><span class="comment">  * 查询所有的用户信息为 map 集合(查询多条数据为 map 集合)</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> 返回一个装着 map 的 map 集合</span></span><br><span class="line"><span class="comment">  * (这里用查询出来的 id 为外层 map 的键, 值就是当前的每一条数据所转换为的 map 集合)</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@MapKey(&quot;id&quot;)</span></span><br><span class="line">Map&lt;String, Object&gt; <span class="title function_">getAllUserToMapByMapKey</span><span class="params">()</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Map&lt;String, Object&gt; getAllUserToMapByMapKey(); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAllUserToMapByMapKey&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testAllUserToMapByMapKey</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">SelectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SelectMapper.class);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, Object&gt; map = mapper.getAllUserToMapByMapKey();</span><br><span class="line">    System.out.println(map);</span><br><span class="line">    <span class="comment">/*  运行结果:</span></span><br><span class="line"><span class="comment">            &#123;1=&#123;password=123456, gender=男, id=1, age=23, email=12345@qq.com, username=admin&#125;,</span></span><br><span class="line"><span class="comment">            4=&#123;password=123456, gender=女, id=4, age=33, email=123@qq.com, username=root&#125;&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="8-特殊-SQL-的执行"><a href="#8-特殊-SQL-的执行" class="headerlink" title="8. 特殊 SQL 的执行"></a>8. 特殊 SQL 的执行</h3><h4 id="8-1-模糊查询"><a href="#8-1-模糊查询" class="headerlink" title="8.1 模糊查询"></a>8.1 模糊查询</h4><blockquote>
<p>直接用 <code>#&#123;&#125;</code> 会报错(因为 ? 在引号里头, 不会被当成占位符解析, 而是被当成了字符串)，因此采用如下三种方法：</p>
<p>a&gt; <strong>${}</strong> (慎用, 会有 sql 注入的风险)</p>
<p>b&gt; <strong>concat 字符串拼接函数 和 #{}</strong></p>
<p>c&gt; <strong>双引号 和 #{}</strong> (该方式比较<strong>常用</strong>)</p>
</blockquote>
<p>（1）&#x3D;&#x3D;直接用 ${}&#x3D;&#x3D;</p>
<ul>
<li><p>创建 mapper 接口和 映射文件</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672677489247.png" alt="图8.1.1"></p>
</li>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thr.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SpecialSQLMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 如果不确定查询出来的结果有几条, 建议使用 list 集合来获取(即用 list 作为返回值)</span></span><br><span class="line">    <span class="comment">// 因为如果用实体类对象来接收的话, 会报错(TooManyResultException)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过用户名模糊查询用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> blur 模糊查询的限定条件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回存放 User 对象的 list 集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">getUserByLike</span><span class="params">(<span class="meta">@Param(&quot;blur&quot;)</span> String blur)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;User&gt; getUserByLike(@Param(&quot;blur&quot;) String blur); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user where username like &#x27;%$&#123;blur&#125;%&#x27;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetUserByLike</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">SpecialSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SpecialSQLMapper.class);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; list = mapper.getUserByLike(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">    <span class="comment">// 结果: User&#123;id=1, username=&#x27;admin&#x27;, password=&#x27;123456&#x27;, age=23, gender=&#x27;男&#x27;, email=&#x27;12345@qq.com&#x27;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>（2）&#x3D;&#x3D;使用 mysql 中的 concat 字符串拼接函数 和 #{}&#x3D;&#x3D;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;User&gt; getUserByLike(@Param(&quot;blur&quot;) String blur); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user where username like concat(&#x27;%&#x27;, #&#123;blur&#125;, &#x27;%&#x27;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）&#x3D;&#x3D;使用 双引号 和 #{}&#x3D;&#x3D;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;User&gt; getUserByLike(@Param(&quot;blur&quot;) String blur); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserByLike&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from t_user where username like &quot;%&quot;#&#123;blur&#125;&quot;%&quot;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="8-2-批量删除"><a href="#8-2-批量删除" class="headerlink" title="8.2 批量删除"></a>8.2 批量删除</h4><blockquote>
<p>mysql 中写的 sql 语句：</p>
<p>DELETE FROM t_user WHERE id &#x3D; 5 OR id &#x3D; 6;<br>DELETE FROM t_user WHERE id IN(7,8);</p>
<p>由于 #{} 会在参数两边自动拼接单引号，会导致出错，但不会报错，只是更新的数据为0条，例如：如果使用#{}，则解析后的sql语句为 delete from t_user where id in (‘1,2,3’)，这样是将1,2,3看做是一个整体，只有id为 1,2,3 的数据会被删除。正确的语句应该是delete from t_user where id in (1,2,3)，或者delete from t_user where id in (‘1’,’2’,’3’) 。所以<strong>只能使用 ${}</strong></p>
</blockquote>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量删除的功能</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ids 用户 id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteMoreUser</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> String ids)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- void deleteMoreUser(@Param(&quot;ids&quot;) String ids);  // eg. ids: 9, 10--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteMoreUser&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 此处不能直接用 in(#&#123;ids&#125;), 因为其本质是占位符赋值,</span></span><br><span class="line"><span class="comment">             所以其会为我们所赋的值自动加上单引号, 解析后变成 in(&#x27;9,10&#x27;), 故报错</span></span><br><span class="line"><span class="comment">             该处用 in() 进行批量删除时只能采用 $&#123;&#125; </span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    delete from t_user where id in($&#123;ids&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteMoreUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">SpecialSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SpecialSQLMapper.class);</span><br><span class="line"></span><br><span class="line">    mapper.deleteMoreUser(<span class="string">&quot;9, 10&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-3-动态设置表名"><a href="#8-3-动态设置表名" class="headerlink" title="8.3 动态设置表名"></a>8.3 动态设置表名</h4><blockquote>
<p>**只能使用 ${}**，因为表名不能加单引号 </p>
</blockquote>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 动态设置表名, 查询对应表当前所有用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tableName 表名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回存放 当前表每条信息转换成的 User对象 的 list 集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;User&gt; <span class="title function_">getUserList</span><span class="params">(<span class="meta">@Param(&quot;tableName&quot;)</span> String tableName)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;User&gt; getUserList(@Param(&quot;tableName&quot;) String tableName); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserList&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 注意！表名是不能加单引号的, 所以直接用 #&#123;&#125; 会报错！</span></span><br><span class="line"><span class="comment">             所有该处动态设置表名时只能使用 $&#123;&#125;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    select * from $&#123;tableName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetUserList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">SpecialSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SpecialSQLMapper.class);</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; list = mapper.getUserList(<span class="string">&quot;t_user&quot;</span>);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-4-添加功能获取自增的主键-常用！难理解"><a href="#8-4-添加功能获取自增的主键-常用！难理解" class="headerlink" title="8.4 添加功能获取自增的主键(常用！难理解)"></a>8.4 添加功能获取自增的主键(常用！难理解)</h4><blockquote>
<p>也就是说，这个insertUser方法的目的是为了实现添加一个数据，并且获取他的自增列然后把jdbc自增列的值赋给我们实体类对应的属性</p>
<p><strong>注意看，最后的user不是查出来的，是传进数据库操作的对象，user的id值在进行xml操作时，被赋了值</strong></p>
<p>其实就一个功能 你没设置前在控制台看不到 id 多少 但是数据库已经自动设置好了，设置后能在控制台看到</p>
<p><strong>实际上就是添加了一个数据并在 id 上回显添加成功的这次 id</strong></p>
<p><strong>场景模拟</strong>：假设现在有两张表：</p>
<p>t_clazz(clazz_id,clazz_name)   <strong>学生表</strong></p>
<p>t_student(student_id,student_name,clazz_id)   <strong>班级表</strong></p>
<p>需求：<strong>在添加班级信息的同时为班级分配学生</strong>(需要在多的一方设置主键，即在学生里面设置班级的 id)</p>
<p>1、添加班级信息  </p>
<p>2、获取新添加的班级的 id  </p>
<p>3、为班级分配学生，即将某学生的班级 id 修改为新添加的班级的 id</p>
</blockquote>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加用户信息并获取自增的主键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> user User 对象</span></span><br><span class="line"><span class="comment"> * useGeneratedKeys: 设置使用自增的主键</span></span><br><span class="line"><span class="comment"> * keyProperty: 因为增删改有统一的返回值(是受影响的行数),</span></span><br><span class="line"><span class="comment"> *             因此只能将获取的自增的主键放在传输的参数 user 对象的某个属性中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- void insertUser(User user); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            useGeneratedKeys: 表示当前的添加功能使用了自增的主键</span></span><br><span class="line"><span class="comment">            keyProperty: 将添加的数据的自增主键为实体类类型的参数的属性赋值</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    insert into t_user values(null, #&#123;username&#125;, #&#123;password&#125;, #&#123;age&#125;, #&#123;gender&#125;, #&#123;email&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">SpecialSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(SpecialSQLMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="literal">null</span>, <span class="string">&quot;xiaoming&quot;</span>, <span class="string">&quot;123456&quot;</span>, <span class="number">23</span>, <span class="string">&quot;男&quot;</span>, <span class="string">&quot;123@qq.com&quot;</span>);</span><br><span class="line">    mapper.insertUser(user);</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="9-自定义映射-resultMap"><a href="#9-自定义映射-resultMap" class="headerlink" title="9. 自定义映射 resultMap"></a>9. 自定义映射 resultMap</h3><h4 id="9-0-准备工作"><a href="#9-0-准备工作" class="headerlink" title="9.0 准备工作"></a>9.0 准备工作</h4><ul>
<li><p>创建一个新模块</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672763714001.png" alt="图9.0.1"></p>
</li>
<li><p>将原先的 jdbc 配置文件、log4j 文件和 util 类复制过来，再创建包、核心配置文件等(搭建 MyBatis 框架)</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672764073181.png" alt="图9.0.2"></p>
</li>
<li><p><strong>创建员工表和部门表</strong></p>
<blockquote>
<p>员工 和 部门 是 多对一 的关系 </p>
<p>在多的一方，即员工表中添上部门的 id 这一字段</p>
</blockquote>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672764522519.png" alt="图9.0.3"></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672764341273.png" alt="图9.0.4"></p>
</li>
<li><p>添加一些测试数据</p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672764721770.png" alt="图9.0.5"></p>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672764736186.png" alt="图9.0.6"></p>
</li>
<li><p><strong>创建 主体类</strong>(包含有参无参构造、getter和setter、toString方法) <strong>和 mapper 接口</strong></p>
<blockquote>
<p>此处的 Emp 中 缺少 dept_id 字段对应的属性</p>
<p>并且注意此处 Emp 类中与 <strong>emp_id</strong> 和 emp_name 字段名对应的属性名是 <strong>empId</strong> 和 empName（一个是下划线，一个是驼峰式命名，导致<strong>字段和属性名不一致</strong>）</p>
</blockquote>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672765149801.png" alt="图9.0.7"></p>
</li>
</ul>
<h4 id="9-1-resultMap-处理字段和属性的映射关系-字段和属性名不一致"><a href="#9-1-resultMap-处理字段和属性的映射关系-字段和属性名不一致" class="headerlink" title="9.1 resultMap 处理字段和属性的映射关系(字段和属性名不一致)"></a>9.1 resultMap 处理字段和属性的映射关系(字段和属性名不一致)</h4><blockquote>
<p> 若<strong>字段名和属性名不一致</strong>，则<strong>查询的结果</strong>中，属性名和字段名<strong>不一致的属性值为 null</strong> </p>
</blockquote>
<p>（1）解决方法一：&#x3D;&#x3D;在 SQL 语句中起别名&#x3D;&#x3D;</p>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thr.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据 id 查询员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> empId 员工 id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回一个 Emp 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Emp <span class="title function_">getEmpByEmpId</span><span class="params">(<span class="meta">@Param(&quot;empId&quot;)</span> Integer empId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Emp getEmpByEmpId(@Param(&quot;empId&quot;) Integer empId); --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByEmpId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 1. 在 SQL 语句中起别名(不用 select * , 而是用 select 具体的字段) --&gt;</span></span><br><span class="line">        select emp_id empId, emp_name empName, age, gender from t_emp where emp_id = #&#123;empId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpByEmpId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> mapper.getEmpByEmpId(<span class="number">1</span>);</span><br><span class="line">    System.out.println(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>（2）解决方法二：&#x3D;&#x3D;在核心配置文件的 settings 标签设置全局配置&#x3D;&#x3D;</p>
<ul>
<li><p>在 官方文档里头找到并<strong>复制到核心配置文件</strong>中</p>
<blockquote>
<p>注意核心配置文件里的<strong>标签顺序</strong>：properties?,settings?,typeAliases?….</p>
<p>可以把这块代码直接放在 模板文件 里头</p>
</blockquote>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672766963965.png" alt="图9.1.1"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 自动将下划线映射为驼峰 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Emp getEmpByEmpId(@Param(&quot;empId&quot;) Integer empId); --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByEmpId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 2. 在核心配置文件的 settings 标签设置全局配置 --&gt;</span></span><br><span class="line">        select * from t_emp where emp_id = #&#123;empId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>（3）解决方法三：&#x3D;&#x3D;使用 resultMap 自定义映射处理&#x3D;&#x3D;</p>
<ul>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 3. 使用 resultMap 自定义映射处理(编写自定义映射)</span></span><br><span class="line"><span class="comment">            id: 唯一标识</span></span><br><span class="line"><span class="comment">            type: 处理映射关系的实体类类型</span></span><br><span class="line"><span class="comment">            常用的标签:</span></span><br><span class="line"><span class="comment">                id: 处理主键和实体类中属性的映射关系</span></span><br><span class="line"><span class="comment">                result: 处理普通字段和实体类中属性的映射</span></span><br><span class="line"><span class="comment">            标签里头的属性:</span></span><br><span class="line"><span class="comment">                column: 设置映射关系中的字段名, 必须是 sql 查询出的某个字段</span></span><br><span class="line"><span class="comment">                property: 设置映射关系中的属性的属性名, 必须是实体类类型中的属性名</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Emp getEmpByEmpId(@Param(&quot;empId&quot;) Integer empId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByEmpId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empResultMap&quot;</span>&gt;</span></span><br><span class="line">    select * from t_emp where emp_id = #&#123;empId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="9-2-多对一映射处理"><a href="#9-2-多对一映射处理" class="headerlink" title="9.2 多对一映射处理"></a>9.2 多对一映射处理</h4><blockquote>
<p>场景模拟：查询员工信息以及员工所对应的部门信息</p>
<p>首先在 Emp 类添加 private Dept dept; 属性 </p>
<p>在 <strong>员工Emp类 中设置 部门Dept类型 的属性</strong>，表示当前所对应的员工的部门(<strong>一是对象，多是集合，多对一则在”多“的类中创建”一“的类型的属性</strong>)，同时添加 getter and setter 并重写 toString 方法 </p>
<p>就是<strong>通过一个sql查询emp，要把里面的dept属性赋值的问题</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2. 处理多对一的映射关系(就是通过一个sql查询emp，要把里面的dept属性赋值的问题)</span><br><span class="line">   下面的方法都用的是 resultMap !!</span><br><span class="line">   2.1 级联方式处理</span><br><span class="line">   2.2 association 标签(javaType: 设置要处理的属性的类型)</span><br><span class="line">   处理多对一(或一对一)的映射关系(实际是处理实体类类型的属性)</span><br><span class="line">   2.3 分步查询(先查员工, 查完员工后知道员工所对应的部门 id,</span><br><span class="line">   再把部门 id 作为条件去部门表里查部门信息, 查询的结果再赋值给 emp类 里头的 dept对象)</span><br><span class="line">   (相当于用第一步结果中的 dept_id 这个结果作为第二部查询的条件)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>（1）&#x3D;&#x3D;级联方式处理映射关系&#x3D;&#x3D;</p>
<ul>
<li><p>在 mapper 接口里<strong>编写方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取员工以及所对应的部门信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> empId 员工 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回一个 Emp 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Emp <span class="title function_">getEmpAndDeptByEmpId</span><span class="params">(<span class="meta">@Param(&quot;empId&quot;)</span> Integer empId)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2.1 级联(将 emp类 中的属性(对象类型的属性)的属性映射到字段)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empAndDeptResultMapOne&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;dept.deptId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;dept.deptName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Emp getEmpAndDeptByEmpId(@Param(&quot;empId&quot;) Integer empId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDeptByEmpId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empAndDeptResultMapOne&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 多表查询(该处采用左外连接, 查询所有员工及其部门, 如部门为空, 显示 null) --&gt;</span></span><br><span class="line">    select t_emp.*, t_dept.*</span><br><span class="line">    from t_emp left join t_dept</span><br><span class="line">    on t_emp.dept_id = t_dept.dept_id</span><br><span class="line">    where t_emp.emp_id = #&#123;empId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpAndDeptByEmpId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> mapper.getEmpAndDeptByEmpId(<span class="number">1</span>);</span><br><span class="line">    System.out.println(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>（2）&#x3D;&#x3D;使用 association 处理映射关系&#x3D;&#x3D;</p>
<ul>
<li><p>在映射文件里<strong>写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2.2 association 标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empAndDeptResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            association 标签: 处理多对一(或一对一)的映射关系(实际是处理实体类类型的属性)</span></span><br><span class="line"><span class="comment">            该标签里头的属性:</span></span><br><span class="line"><span class="comment">                property: 设置需要处理映射关系的属性的属性名</span></span><br><span class="line"><span class="comment">                javaType: 设置要处理的属性的类型</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;deptId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>（3）&#x3D;&#x3D;分步查询&#x3D;&#x3D;</p>
<ul>
<li><p> 在 <strong>EmpMapper</strong> 接口<strong>添加分步查询的第一步</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过分步查询获取员工以及所对应的部门信息的第一步</span></span><br><span class="line"><span class="comment"> * 分步查询第一步：查询员工信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> empId 员工 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回一个 Emp 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Emp <span class="title function_">getEmpAndDeptByStepOne</span><span class="params">(<span class="meta">@Param(&quot;empId&quot;)</span> Integer empId)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>再创建一个 <strong>DeptMapper</strong> 接口<strong>添加分步查询的第二步</strong> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thr.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查哪张表就写在其对应的接口中</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DeptMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过分步查询获取员工以及所对应的部门信息的第二步</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> deptId 在第一步查询到的员工信息里的部门 id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 返回一个 部门Dept类 对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Dept <span class="title function_">getEmpAndDeptByStepTwo</span><span class="params">(<span class="meta">@Param(&quot;deptId&quot;)</span> Integer deptId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 映射文件中<strong>添加 SQL 语句及 resultMap</strong> </p>
<blockquote>
<p>获取方法的唯一标识：</p>
</blockquote>
<p><img src="/../img/SSM%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88.assets/1672831119262.png" alt="图9.2.1"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 2.3 分步查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;empAndDeptByStepResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            property: 设置需要处理映射关系的属性的属性名</span></span><br><span class="line"><span class="comment">            select: 设置分步查询的 sql 的唯一标识(mapper 接口的全类名 + 查询语句的 id)</span></span><br><span class="line"><span class="comment">            column: 将查询出的某个字段作为分步查询的 sql 的条件</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">select</span>=<span class="string">&quot;com.thr.mybatis.mapper.DeptMapper.getEmpAndDeptByStepTwo&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Emp getEmpAndDeptByStepOne(@Param(&quot;empId&quot;) Integer empId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDeptByStepOne&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;empAndDeptByStepResultMap&quot;</span>&gt;</span></span><br><span class="line">    select * from t_emp where emp_id = #&#123;empId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.thr.mybatis.mapper.DeptMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Dept getEmpAndDeptByStepTwo(@Param(&quot;deptId&quot;) Integer deptId); --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpAndDeptByStepTwo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">        select * from t_dept where dept_id = #&#123;deptId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpAndDeptByStep</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> mapper.getEmpAndDeptByStepOne(<span class="number">2</span>);</span><br><span class="line">    System.out.println(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>（4）<strong>分步查询的优点：延迟加载(懒加载)</strong></p>
<blockquote>
<p>分步查询的优点：可以实现延迟加载</p>
<p>但是必须在核心配置文件中<strong>设置全局配置信息</strong>(在 settings 标签中进行设置)：</p>
<p><strong>lazyLoadingEnabled</strong>：延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。这里需要<strong>设置为 true</strong></p>
<p><strong>aggressiveLazyLoading</strong>：当开启时，<strong>任何方法的调用都会加载该对象的所有属性</strong>。 否则，每个属性会按需加载。这里需要<strong>设置为 false</strong>(mybatis 版本小于等于3.4.1时，默认为 true，其他版本默认为 false，所以高版本可以不用设置)</p>
<p>此时就可以实现按需加载，<strong>获取的数据是什么，就只会执行相应的sql</strong>。此时可通过 association 和 collection 中的<strong>fetchType 属性设置当前的分步查询是否使用延迟加载</strong>，<strong>fetchType&#x3D;”lazy(延迟加载)|eager(立即加载)”</strong></p>
<p>延迟加载就是我需要分步加载中的哪一步就只执行哪一步</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 自动将下划线映射为驼峰 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 开启延迟加载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 按需加载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="9-3-一对多映射处理"><a href="#9-3-一对多映射处理" class="headerlink" title="9.3 一对多映射处理"></a>9.3 一对多映射处理</h4><blockquote>
<p>一个部门里有多个员工（对多对应集合）</p>
<p>需求：查询部门信息并把当前部门中的所有员工也查出来</p>
<p><strong>在 Dept 类中添加属性 private List&lt;Emp&gt; emps;</strong> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3. 处理一对多的映射关系</span><br><span class="line">	3.1 collection -&gt; 处理一对多或者多对多的映射关系(处理集合类型的属性)</span><br><span class="line">		ofType: 设置当前集合中的属性</span><br><span class="line">	3.2 分步查询</span><br></pre></td></tr></table></figure>
</blockquote>
<p>（1）&#x3D;&#x3D;collection&#x3D;&#x3D;</p>
<ul>
<li><p>在 <strong>DeptMapper 接口中添加方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询部门以及部门中的员工信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> deptId 部门 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回一个部门对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Dept <span class="title function_">getDeptAndEmpByDeptId</span><span class="params">(<span class="meta">@Param(&quot;deptId&quot;)</span> Integer deptId)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 DeptMapper <strong>映射文件中写 sql 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 3.1 collection 标签(处理一对多或者多对多的映射关系(处理集合类型的属性)) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;DeptAndEmpResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;deptId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            ofType: 设置集合类型的属性中存储的数据的类型</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;emp_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;emp_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;empName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Dept getDeptAndEmpByDeptId(@Param(&quot;deptId&quot;) Integer deptId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmpByDeptId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;DeptAndEmpResultMap&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from t_dept left join t_emp</span><br><span class="line">    on t_dept.dept_id = t_emp.dept_id</span><br><span class="line">    where t_dept.dept_id = #&#123;deptId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetDeptAndAEmpByDeptId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">DeptMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DeptMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">Dept</span> <span class="variable">dept</span> <span class="operator">=</span> mapper.getDeptAndEmpByDeptId(<span class="number">1</span>);</span><br><span class="line">    System.out.println(dept);</span><br><span class="line">    <span class="comment">/* 运行结果</span></span><br><span class="line"><span class="comment">        Dept&#123;deptId=1, deptName=&#x27;A&#x27;, emps=[</span></span><br><span class="line"><span class="comment">                Emp&#123;empId=1, empName=&#x27;张三&#x27;, age=20, gender=&#x27;男&#x27;, dept=null&#125;,</span></span><br><span class="line"><span class="comment">                Emp&#123;empId=4, empName=&#x27;赵六&#x27;, age=24, gender=&#x27;男&#x27;, dept=null&#125;</span></span><br><span class="line"><span class="comment">                ]</span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>（2）&#x3D;&#x3D;分步查询&#x3D;&#x3D;</p>
<ul>
<li><p>在 <strong>DeptMapper 接口中添加方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过分步查询查询部门以及部门中的员工信息第一步(一对多)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> deptId 部门 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回一个部门对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Dept <span class="title function_">getDeptAndEmpByStepOne</span><span class="params">(<span class="meta">@Param(&quot;deptId&quot;)</span> Integer deptId)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 <strong>EmpMapper 接口中添加方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过分步查询查询部门以及部门中的员工信息第二步(一对多)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> deptId 部门 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回一个包含 Emp 对象的 List 集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Emp&gt; <span class="title function_">getDeptAndEmpByStepTwo</span><span class="params">(<span class="meta">@Param(&quot;deptId&quot;)</span> Integer deptId)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 映射文件中<strong>添加 SQL 语句及 resultMap</strong> </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 3.2 分步查询第一步 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;deptAndEmpResultMapByStep&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Dept&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;deptId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;dept_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;deptName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;emps&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">select</span>=<span class="string">&quot;com.thr.mybatis.mapper.EmpMapper.getDeptAndEmpByStepTwo&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Dept getDeptAndEmpByStepOne(@Param(&quot;deptId&quot;) Integer deptId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmpByStepOne&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;deptAndEmpResultMapByStep&quot;</span>&gt;</span></span><br><span class="line">    select * from t_dept where dept_id = #&#123;deptId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 3.2 分步查询第二步 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- List&lt;Emp&gt; getDeptAndEmpByStepTwo(@Param(&quot;deptId&quot;) Integer deptId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getDeptAndEmpByStepTwo&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">    select * from t_emp where dept_id = #&#123;deptId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetDeptAndAEmpByStep</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">DeptMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DeptMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">Dept</span> <span class="variable">dept</span> <span class="operator">=</span> mapper.getDeptAndEmpByStepOne(<span class="number">1</span>);</span><br><span class="line">    System.out.println(dept);</span><br><span class="line">    System.out.println(dept.getDeptName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="10-动态-SQL"><a href="#10-动态-SQL" class="headerlink" title="10. 动态 SQL"></a>10. 动态 SQL</h3><blockquote>
<p>MyBatis 框架的 动态SQL 技术是一种<strong>根据特定条件动态拼装SQL语句的功能</strong>，它存在的意义是为了解决拼接SQL语句字符串时的痛点问题</p>
<p>比如说根据图书编号，图书名，作者查询，只填一个，或者两个，或者三个，如果填了就添加在 sql 语句中，没填就不用(动态 sql)</p>
<p><strong>不是 null 或者 空字符串 就进行拼接</strong>，是 null 或者 空字符串 就不拼接</p>
<p>若都是空，需求一般就是要打印所有记录信息的</p>
</blockquote>
<ul>
<li><p>创建新的工程，设置好配置文件啥的</p>
<p><img src="/../img/MyBatis%E5%85%A5%E9%97%A8.assets/1672854914967.png" alt="图10.0.1"></p>
</li>
</ul>
<h4 id="10-1-if"><a href="#10-1-if" class="headerlink" title="10.1 if"></a>10.1 if</h4><blockquote>
<p>if标签可通过 test 属性（即传递过来的数据）的表达式进行判断，若表达式的结果为true，则标签中的内容会执行；反之标签中的内容不会执行</p>
<p>if: 通过 test 属性中的表达式<strong>判断标签中的内容是否有效(是否会拼接到 sql 中)</strong></p>
</blockquote>
<ul>
<li><p>在 mapper <strong>接口中添加方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据条件查询员工信息(多条件查询)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> emp 一个员工对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回 list 集合(因为不确定有几条返回值)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Emp&gt; <span class="title function_">getEmpByCondition</span><span class="params">(Emp emp)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 映射文件中<strong>添加 SQL 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;Emp&gt; getEmpByCondition(Emp emp); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 1. if 标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">    select * from t_emp where</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        emp_name = #&#123;empName&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        and age = #&#123;age&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null and gender != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">        and gender = #&#123;gender&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpByCondition</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">20</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    List&lt;Emp&gt; list = mapper.getEmpByCondition(emp);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="10-2-where"><a href="#10-2-where" class="headerlink" title="10.2 where"></a>10.2 where</h4><blockquote>
<p>为了解决后面条件不成立导致 sql 语句多出来的 where 的问题，<strong>一种方法是在 where 后头加上 ”1&#x3D;1“ 的恒成立条件</strong>，再将后头判断语句的前面都加上 ”and“ 即可，<strong>另一种方法是使用 where 标签</strong></p>
<p>where 和 if一般结合使用：</p>
<ul>
<li><strong>若 where 标签中的 if 条件都不满足</strong>，则where标签没有任何功能，即<strong>不会添加where关键字</strong></li>
<li><strong>若 where 标签中的 if 条件满足</strong>，则where标签会<strong>自动添加 where 关键字，并将条件最前方多余的 and 和 or 去掉</strong></li>
</ul>
<p><strong>注意：where标签不能去掉条件最后多余的and</strong></p>
</blockquote>
<ul>
<li><p>映射文件里的 sql 语句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;Emp&gt; getEmpByCondition(Emp emp); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 2. where 标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">    select * from t_emp</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            emp_name = #&#123;empName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and age = #&#123;age&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null and gender != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and gender = #&#123;gender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="10-3-trim"><a href="#10-3-trim" class="headerlink" title="10.3 trim"></a>10.3 trim</h4><blockquote>
<p>trim 用于<strong>去掉或添加标签中的内容</strong></p>
<p>常用属性:</p>
<p><strong>prefix</strong>：在trim标签中的内容的<strong>前面添加</strong>某些内容</p>
<p><strong>suffix</strong>：在trim标签中的内容的<strong>后面添加</strong>某些内容</p>
<p><strong>prefixOverrides</strong>：在trim标签中的内容的<strong>前面去掉</strong>某些内容</p>
<p><strong>suffixOverrides</strong>：在trim标签中的内容的<strong>后面去掉</strong>某些内容</p>
</blockquote>
<ul>
<li><p>映射文件里的 sql 语句</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;Emp&gt; getEmpByCondition(Emp emp); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 3. trim 标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">    select * from t_emp</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;and&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            emp_name = #&#123;empName&#125; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            age = #&#123;age&#125; and</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null and gender != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            gender = #&#123;gender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="10-4-choose、when、otherwise"><a href="#10-4-choose、when、otherwise" class="headerlink" title="10.4 choose、when、otherwise"></a>10.4 choose、when、otherwise</h4><blockquote>
<p>choose、when、otherwise <strong>相当于 if …… else if …… else ……</strong>  一个成立后面便不再执行, 所以也不用加 and</p>
<p>因此 where 后头最多只能加一个条件, 不能多条件查询了</p>
<p><strong>when(表示 if..elif) 至少设置一个</strong>, <strong>otherwise(表示 else) 最多设置一个</strong></p>
</blockquote>
<ul>
<li><p>在 mapper <strong>接口中添加方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 choose 查询员工信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> emp 一个员工对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回 list 集合(因为不确定有几条返回值)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">List&lt;Emp&gt; <span class="title function_">getEmpByChoose</span><span class="params">(Emp emp)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 映射文件中<strong>添加 SQL 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- List&lt;Emp&gt; getEmpByChoose(Emp emp); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 4. choose, when, otherwise 标签 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpByChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">    select * from t_emp</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;empName != null and empName != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                emp_name = #&#123;empName&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;age != null and age != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                age = #&#123;age&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;gender != null and gender != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                gender = #&#123;gender&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="10-5-foreach-重要"><a href="#10-5-foreach-重要" class="headerlink" title="10.5 foreach(重要)"></a>10.5 foreach(重要)</h4><blockquote>
<p>foreach: <strong>循环执行该标签里头的内容</strong>, 其<strong>具体属性</strong>有:<br>           <strong>collection</strong>: 设置要循环的数组或集合<br>           <strong>item</strong>: 用一个字符串来表示数组或集合中的每一个数据<br>           <strong>separator</strong>: 设置每次循环的数据之间的分隔符<br>           <strong>open</strong>: 循环的所有内容以什么开始<br>           <strong>close</strong>: 循环的所有内容以什么结束</p>
</blockquote>
<p>（1）&#x3D;&#x3D;批量添加&#x3D;&#x3D;</p>
<ul>
<li><p>在 mapper <strong>接口中添加方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 批量添加员工信息</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> emps 存放 Emp对象的集合</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insertMoreEmp</span><span class="params">(<span class="meta">@Param(&quot;emps&quot;)</span> List&lt;Emp&gt; emps)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 映射文件中<strong>添加 SQL 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- void insertMoreEmp(@Param(&quot;emps&quot;) List&lt;Emp&gt; emps); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 5.1 foreach 批量添加 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;insertMoreEmp&quot;</span>&gt;</span></span><br><span class="line">    insert into t_emp values</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;emps&quot;</span> <span class="attr">item</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        (null, #&#123;emp.empName&#125;, #&#123;emp.age&#125;, #&#123;emp.gender&#125;, null)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsertMoreEmp</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;小明1&quot;</span>, <span class="number">20</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;小明2&quot;</span>, <span class="number">20</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="literal">null</span>, <span class="string">&quot;小明3&quot;</span>, <span class="number">20</span>, <span class="string">&quot;男&quot;</span>);</span><br><span class="line">    List&lt;Emp&gt; list = Arrays.asList(emp1, emp2, emp3);</span><br><span class="line">    mapper.insertMoreEmp(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>（2）&#x3D;&#x3D;批量删除&#x3D;&#x3D;</p>
<ul>
<li><p>在 mapper <strong>接口中添加方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量删除用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> empIds 存放 用户id 的数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">deleteMoreEmp</span><span class="params">(<span class="meta">@Param(&quot;empIds&quot;)</span> Integer[] empIds)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 映射文件中<strong>添加 SQL 语句</strong></p>
<blockquote>
<p>此处删除可用两种方法 </p>
<ul>
<li><strong>where id in(???)</strong></li>
<li><strong>where or…or…</strong></li>
</ul>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- void deleteMoreEmp(@Param(&quot;empIds&quot;) Integer[] empIds); --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 5.2 foreach 批量删除 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;deleteMoreEmp&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 5.2.1 用 where..in(?,?,?) --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--delete from t_emp where emp_id in</span></span><br><span class="line"><span class="comment">        &lt;foreach collection=&quot;empIds&quot; item=&quot;empId&quot; separator=&quot;,&quot; open=&quot;(&quot; close=&quot;)&quot;&gt;</span></span><br><span class="line"><span class="comment">             #&#123;empId&#125;</span></span><br><span class="line"><span class="comment">        &lt;/foreach&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 5.2.1 用 where...or... --&gt;</span></span><br><span class="line">    delete from t_emp where</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;empIds&quot;</span> <span class="attr">item</span>=<span class="string">&quot;empId&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;or&quot;</span>&gt;</span></span><br><span class="line">        emp_id = #&#123;empId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDeleteMoreEmp</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">DynamicSQLMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(DynamicSQLMapper.class);</span><br><span class="line"></span><br><span class="line">    Integer[] empIds = <span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">6</span>, <span class="number">7</span>&#125;;</span><br><span class="line">    mapper.deleteMoreEmp(empIds);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="10-6-SQL-片段"><a href="#10-6-SQL-片段" class="headerlink" title="10.6 SQL 片段"></a>10.6 SQL 片段</h4><blockquote>
<p><strong>select * 少用</strong>，数据多了的话查询效率特低，因为查询的时候会先把<em>查询成所有字段，所以<strong>建议写全</strong>，写全以后又很麻烦，*<em>直接用sql标签，然后引用，减少代码冗余</em></em></p>
<p>sql片段，可以<strong>记录一段公共sql片段，在使用的地方通过 include 标签进行引入</strong></p>
</blockquote>
<ul>
<li><p><strong>声明</strong> sql 片段 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;empColumns&quot;</span>&gt;</span></span><br><span class="line">    emp_id, emp_name, age, gender, dept_id</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>引用</strong> sql 片段 </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;empColumns&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span> from t_emp</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="11-MyBatis-的缓存"><a href="#11-MyBatis-的缓存" class="headerlink" title="11. MyBatis 的缓存"></a>11. MyBatis 的缓存</h3><ul>
<li><p>创建新的工程</p>
<p><img src="/../img/MyBatis%E5%85%A5%E9%97%A8.assets/1672862472810.png" alt="图11.0.1"></p>
</li>
</ul>
<h4 id="11-1-MyBatis-的一级缓存"><a href="#11-1-MyBatis-的一级缓存" class="headerlink" title="11.1 MyBatis 的一级缓存"></a>11.1 MyBatis 的一级缓存</h4><blockquote>
<p><strong>一级缓存是默认开启的</strong>，且是 SqlSession 级别的，也就是通过同一个 SqlSession 查询的数据会被缓存，<strong>下次查询相同的数据，就会从缓存中直接获取，不会从数据库重新访问</strong></p>
<p>使<strong>一级缓存失效</strong>的四种情况：</p>
<p>1）<strong>不同的 SqlSession</strong> 对应不同的一级缓存</p>
<p>2）<strong>同一个 SqlSession 但是查询条件不同</strong></p>
<p>3）<strong>同一个 SqlSession 两次查询期间执行了任何一次增删改操作</strong>(因为任意一次增删改执行完后会自动清空缓存)</p>
<p>4）<strong>同一个 SqlSession 两次查询期间手动清空了缓存</strong>（清空缓存可以使用）</p>
</blockquote>
<ul>
<li><p>在 mapper <strong>接口中添加方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据员工 id 查询员工信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> empId 员工 id</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 返回一个 Emp 对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Emp <span class="title function_">getEmpById</span><span class="params">(<span class="meta">@Param(&quot;empId&quot;)</span> Integer empId)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 映射文件中<strong>添加 SQL 语句</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Emp getEmpById(@Param(&quot;empId&quot;) Integer empId); --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Emp&quot;</span>&gt;</span></span><br><span class="line">    select * from t_emp where emp_id = #&#123;empId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetEmpById</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">            MyBatis的一级缓存: (默认开启)</span></span><br><span class="line"><span class="comment">            sqlSession 级别的, 即通过同一个 sqlSession 查询出来的数据会被缓存</span></span><br><span class="line"><span class="comment">            再次使用同一个 sqlSession 查询同一条数据, 会从缓存中获取</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="comment">// 第一个 sqlSession</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession1</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">CacheMapper</span> <span class="variable">mapper1</span> <span class="operator">=</span> sqlSession1.getMapper(CacheMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp1</span> <span class="operator">=</span> mapper1.getEmpById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(emp1);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 手动清空一级缓存, 会使一级缓存失效</span></span><br><span class="line">    <span class="comment">// sqlSession1.clearCache();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询相同的数据, 从运行结果可以看出只执行了一次 sql, 返回了两条数据</span></span><br><span class="line">    <span class="comment">// 故 emp1 是从数据库里头查的, emp2 是从缓存里查的</span></span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp2</span> <span class="operator">=</span> mapper1.getEmpById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(emp2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二个 sqlSession</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession2</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">CacheMapper</span> <span class="variable">mapper2</span> <span class="operator">=</span> sqlSession2.getMapper(CacheMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// emp3 会再次从数据库里头查, 因为与上头那个不是同一个 sqlSession</span></span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp3</span> <span class="operator">=</span> mapper2.getEmpById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(emp3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="11-2-MyBatis-的二级缓存"><a href="#11-2-MyBatis-的二级缓存" class="headerlink" title="11.2 MyBatis 的二级缓存"></a>11.2 MyBatis 的二级缓存</h4><blockquote>
<p>二级缓存是 <strong>SqlSessionFactory 级别</strong>，通过同一个SqlSessionFactory 创建的 SqlSession 查询的结果会被缓存；此后若再次执行相同的查询语句，结果就会从缓存中获取</p>
<p>二级缓存<strong>开启的条件</strong>：</p>
<ul>
<li>在核心配置文件中，设置全局配置属性<strong>cacheEnabled&#x3D;”true”<strong>，</strong>默认为true</strong>，<strong>不需要设置</strong></li>
<li>在<strong>映射文件中设置标签 &lt;cache &#x2F;&gt;</strong></li>
<li>二级缓存必须<strong>在SqlSession关闭或提交之后有效</strong></li>
<li>查询的数据所转换的<strong>实体类类型必须实现序列化 Serializable 的接口</strong></li>
</ul>
<p>使二级缓存<strong>失效</strong>的情况：两次查询之间<strong>执行了任意的增删改，会使一级和二级缓存同时失效</strong></p>
</blockquote>
<ul>
<li><p>查询的数据所转换的实体类类型<strong>实现序列化接口</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emp</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;...&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCache</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 测试二级缓存, 故不能直接用工具类, 需要重新获取一个 SqlSessionFactory</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 由同一个 sqlSessionFactory 得到的 sqlSession1 和 sqlSession2</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession1</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">CacheMapper</span> <span class="variable">mapper1</span> <span class="operator">=</span> sqlSession1.getMapper(CacheMapper.class);</span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp1</span> <span class="operator">=</span> mapper1.getEmpById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(emp1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 二级缓存必须在 SqlSession 关闭或提交之后有效(关闭后, 保存在一级缓存中的数据才会被保存到二级缓存中)</span></span><br><span class="line">    sqlSession1.close();</span><br><span class="line"></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession2</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line">    <span class="type">CacheMapper</span> <span class="variable">mapper2</span> <span class="operator">=</span> sqlSession2.getMapper(CacheMapper.class);</span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp2</span> <span class="operator">=</span> mapper2.getEmpById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(emp2);</span><br><span class="line"></span><br><span class="line">    sqlSession2.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/../img/MyBatis%E5%85%A5%E9%97%A8.assets/1672905310136.png" alt="图11.2.1"></p>
<h4 id="11-3-二级缓存的相关配置"><a href="#11-3-二级缓存的相关配置" class="headerlink" title="11.3 二级缓存的相关配置"></a>11.3 二级缓存的相关配置</h4><blockquote>
<p>cache 标签的<strong>相关属性</strong>：</p>
<ul>
<li><strong>eviction属性</strong>：缓存回收策略</li>
</ul>
<p>LRU（Least Recently Used） – <strong>最近最少使用的</strong>：移除最长时间不被使用的对象。</p>
<p>FIFO（First in First out） – 先进先出：按对象进入缓存的顺序来移除它们。</p>
<p>SOFT – 软引用：移除基于垃圾回收器状态和软引用规则的对象。</p>
<p>WEAK – 弱引用：更积极地移除基于垃圾收集器状态和弱引用规则的对象。</p>
<p><strong>默认的是 LRU</strong></p>
<ul>
<li><strong>flushInterval属性</strong>：刷新间隔，单位毫秒</li>
</ul>
<p><strong>默认情况是不设置，也就是没有刷新间隔，缓存仅仅调用语句（增删改）时刷新</strong></p>
<ul>
<li><strong>size属性</strong>：引用数目，正整数</li>
</ul>
<p>代表<strong>缓存最多可以存储多少个对象</strong>，太大容易导致内存溢出</p>
<ul>
<li><strong>readOnly属性</strong>：<strong>只读</strong>，true&#x2F;false</li>
</ul>
<p>true：只读缓存；会给所有调用者返回缓存对象的相同实例(将缓存的数据直接返回给调用者)。因此这些对象不能被修改。这提供了很重要的性能优势。</p>
<p>false：<strong>读写缓存</strong>；会返回缓存对象的拷贝（通过<strong>序列化</strong>）。这会<strong>慢一些，但是安全，因此默认是false</strong></p>
</blockquote>
<h4 id="11-4-MyBatis-缓存查询的顺序"><a href="#11-4-MyBatis-缓存查询的顺序" class="headerlink" title="11.4 MyBatis 缓存查询的顺序"></a>11.4 MyBatis 缓存查询的顺序</h4><blockquote>
<p>从大范围查到小范围，二级缓存是SqlSessionFactory 范围更大些</p>
<p>若一级缓存和二级缓存都开启，则<strong>先查询二级缓存</strong>，因为二级缓存中可能会有其他程序已经查出来的数据，可以拿来直接使用</p>
<p>如果<strong>二级缓存没有命中，再查询一级缓存</strong>(因为可能没关闭，所以一级里头可能有二级没有的)</p>
<p>二级缓存是要session提交后的数据，而一级缓存里面的数据不一定提交了</p>
<p>如果<strong>一级缓存也没有命中，则查询数据库</strong></p>
<p>SqlSession关闭之前，数据默认保存在一级缓存之中，但<strong>SqlSession关闭之后，一级缓存中的数据会写入二级缓存</strong></p>
</blockquote>
<h4 id="11-5-整合第三方缓存-EHCache-了解即可"><a href="#11-5-整合第三方缓存-EHCache-了解即可" class="headerlink" title="11.5 整合第三方缓存 EHCache(了解即可)"></a>11.5 整合第三方缓存 EHCache(了解即可)</h4><p>（1）<strong>添加依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Mybatis EHCache整合包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- slf4j日志门面的一个具体实现 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）各 jar 包功能</p>
<table>
<thead>
<tr>
<th align="center"><strong>jar 包名称</strong></th>
<th align="center"><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">mybatis-ehcache</td>
<td align="center">Mybatis和EHCache的整合包</td>
</tr>
<tr>
<td align="center">ehcache</td>
<td align="center">EHCache核心包</td>
</tr>
<tr>
<td align="center">slf4j-api</td>
<td align="center">SLF4J日志门面包</td>
</tr>
<tr>
<td align="center">logback-classic</td>
<td align="center">支持SLF4J门面接口的一个具体实现</td>
</tr>
</tbody></table>
<p>（3）<strong>创建 EHCache 的配置文件 ehcache.xml</strong> (名字必须为 ehcache.xml)</p>
<blockquote>
<p>爆红不用管，能实现功能就行</p>
</blockquote>
<p><img src="/../img/MyBatis%E5%85%A5%E9%97%A8.assets/1672908139529.png" alt="图11.5.1"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">&quot;../config/ehcache.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 磁盘保存路径 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">&quot;D:\ehcache&quot;</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 设置缓存的信息 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">            <span class="attr">maxElementsInMemory</span>=<span class="string">&quot;1000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">maxElementsOnDisk</span>=<span class="string">&quot;10000000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">eternal</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">overflowToDisk</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToIdleSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToLiveSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">&quot;120&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">&quot;LRU&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">defaultCache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（4）<strong>设置二级缓存的类型</strong></p>
<blockquote>
<p>在xxxMapper.xml文件中设置二级缓存类型</p>
<p>例如，在 CacheMapper.xml 中设置 </p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.caches.ehcache.EhcacheCache&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>（5）<strong>加入 logback 日志</strong></p>
<blockquote>
<p><strong>存在SLF4J时，作为简易日志的log4j将失效</strong>，此时我们需要借助SLF4J的具体实现logback来打印日志。</p>
<p>创建logback的配置文件 logback.xml，<strong>名字固定，不可改变</strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">debug</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定日志输出的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 日志输出的格式 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 按照顺序分别是：时间、日志级别、线程名称、打印日志的类、日志主体内容、换行 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>[%d&#123;HH:mm:ss.SSS&#125;] [%-5level] [%thread] [%logger] [%msg]%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 设置全局日志级别。日志级别按顺序分别是：DEBUG、INFO、WARN、ERROR --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定任何一个日志级别都只打印当前级别和后面级别的日志。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定打印日志的appender，这里通过“STDOUT”引用了前面配置的appender --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 根据特殊需求指定局部日志级别 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.thr.mybatis.mapper&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="12-MyBatis-的逆向工程"><a href="#12-MyBatis-的逆向工程" class="headerlink" title="12. MyBatis 的逆向工程"></a>12. MyBatis 的逆向工程</h3><blockquote>
<p><strong>正向工程</strong>：先创建Java实体类，由框架负责根据实体类生成数据库表。Hibernate是支持正向工程的</p>
<p><strong>逆向工程</strong>(本质是代码生成器)：<strong>先创建数据库表，由框架负责根据数据库表，反向生成如下资源</strong>：</p>
<ul>
<li>Java实体类</li>
<li>Mapper接口</li>
<li>Mapper映射文件</li>
</ul>
<p>逆向工程时，如果出现生成的实体类总是错误，属性命名没有根据命名规则来，甚至出现了在表中没有的属性：</p>
<p>可以尝试在数据库连接的 URL 后面加上  nullCatalogMeansCurrent&#x3D;true </p>
</blockquote>
<h4 id="12-1-创建逆向工程的步骤-简洁版"><a href="#12-1-创建逆向工程的步骤-简洁版" class="headerlink" title="12.1 创建逆向工程的步骤(简洁版)"></a>12.1 创建逆向工程的步骤(简洁版)</h4><p>（1）<strong>设置打包方式为jar，添加依赖和插件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MyBatis核心依赖包 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- junit测试 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- MySQL驱动 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- log4j日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 控制Maven在构建过程中相关配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 构建过程中用到的插件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 具体插件，逆向工程的操作是以构建过程中插件形式出现的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 插件的依赖 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 逆向工程的核心依赖 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- MySQL驱动 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）创建 MyBatis 的核心配置文件、逆向工程的配置文件</p>
<blockquote>
<p>这里 MyBatis 的核心配置文件 可以先不用填写 typeAliase 和 mappers 的包名，可以等到逆向后再填写</p>
<p> 逆向工程的配置文件名字必须是 generatorConfig.xml，上面的 URI 爆红不用管 </p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        targetRuntime: 执行生成的逆向工程的版本</span></span><br><span class="line"><span class="comment">            MyBatis3Simple: 生成基本的CRUD（清新简洁版）</span></span><br><span class="line"><span class="comment">            MyBatis3: 生成带条件的CRUD（奢华尊享版）</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3Simple&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库的连接信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/ssm?useSSL=false<span class="symbol">&amp;amp;</span></span></span></span><br><span class="line"><span class="string"><span class="tag">                                       serverTimezone=UTC<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=UTF-8&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;thr&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- javaBean的生成策略--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.thr.mybatis.pojo&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\java&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">                enableSubPackages：设置是否能用子包</span></span><br><span class="line"><span class="comment">                    true：targetPackage属性中每一个点对应一层包(目录)</span></span><br><span class="line"><span class="comment">                    false：targetPackage中的名字只作为一层包(目录)</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- trimStrings：去掉字符串前后的空格 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- SQL映射文件的生成策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.thr.mybatis.mapper&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\resources&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- Mapper接口的生成策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.thr.mybatis.mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\java&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 逆向分析的表 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- tableName：设置表名，若设置为*号，可以对应所有表，此时不写domainObjectName --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- domainObjectName：设置生成出来的实体类的类名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;t_emp&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Emp&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;t_dept&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Dept&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）<strong>执行 MBG 插件的 generate 目标</strong>(双击即可)</p>
<p><img src="/../img/MyBatis%E5%85%A5%E9%97%A8.assets/1672910013957.png" alt="图12.1.1"></p>
<blockquote>
<p>执行后，就会在对应位置生成实体类和 xml 文件 </p>
<p>之后注意完善核心配置文件 mybatis-config.xml</p>
<p>将 typeAliases 和 mappers 标签对应的包名填上  </p>
</blockquote>
<p><img src="/../img/MyBatis%E5%85%A5%E9%97%A8.assets/1672910715864.png" alt="图12.1.2"></p>
<h4 id="12-2-逆向工程-MyBatis3-生成的方法说明-奢华版"><a href="#12-2-逆向工程-MyBatis3-生成的方法说明-奢华版" class="headerlink" title="12.2 逆向工程 MyBatis3 生成的方法说明(奢华版)"></a>12.2 逆向工程 MyBatis3 生成的方法说明(奢华版)</h4><blockquote>
<p>1、只要<strong>方法中有 Example</strong>，那就是<strong>根据条件来查询</strong>，<strong>例如</strong> <strong>countByExample 根据条件查询记录数</strong>，deleteByExample 根据条件删除</p>
<p>2、<strong>普通插入</strong> int <strong>insert</strong>(Emp record) 和 <strong>选择性插入</strong> int <strong>insertSelective</strong>(Emp record) 的区别：若传入的方法参数的实体类的某个属性<strong>含有 null 值</strong>，普通插入会将 null 作为该值赋给对应字段，而<strong>选择性插入只会为属性值不是 null 的字段赋值，不会为属性是 null 的字段赋值</strong>。当然，由于默认值为 null，所以效果并不明显</p>
<p>3、<strong>普通修改和选择性修改的区别</strong>：若传入的方法参数的实体类的某个属性含有 null 值，<strong>普通修改会将对应字段赋值为 null</strong>，而<strong>选择性修改只会修改属性不是 null 的对应的字段</strong></p>
</blockquote>
<ul>
<li><p>先将前面自动生成目录等的删除掉，然后在 <strong>generatorConfig.xml 文件</strong>中将执行生成的逆向工程的<strong>版本改成 MyBatis3</strong>，再次找到插件双击即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        targetRuntime: 执行生成的逆向工程的版本</span></span><br><span class="line"><span class="comment">            MyBatis3Simple: 生成基本的CRUD（清新简洁版）</span></span><br><span class="line"><span class="comment">            MyBatis3: 生成带条件的CRUD（奢华尊享版）</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../img/MyBatis%E5%85%A5%E9%97%A8.assets/1672926844177.png" alt="图12.2.1"></p>
<blockquote>
<p>效果如下：</p>
<p>自动生成的Emp类和Dept类是没有 toString 方法和无参有参构造的！建议自己加上去</p>
</blockquote>
<p><img src="/../img/MyBatis%E5%85%A5%E9%97%A8.assets/1672926936391.png" alt="图12.2.2"></p>
</li>
<li><p><strong>测试</strong></p>
<blockquote>
<p>对于单表而言很好用，多表查询还是乖乖的自己写 sql 语句</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testMBG</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 根据主键 id 查用户信息</span></span><br><span class="line">    <span class="comment">/*Emp emp = mapper.selectByPrimaryKey(1);</span></span><br><span class="line"><span class="comment">        System.out.println(emp);*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 查所有用户信息(放个 null 进去即可)</span></span><br><span class="line">    <span class="comment">/*List&lt;Emp&gt; list = mapper.selectByExample(null);</span></span><br><span class="line"><span class="comment">        list.forEach(System.out::println);*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 根据条件查询数据(Query By Criteria: QBC 查询)</span></span><br><span class="line">    <span class="comment">/*EmpExample example = new EmpExample();</span></span><br><span class="line"><span class="comment">        example.createCriteria().andEmpNameEqualTo(&quot;张三&quot;).andAgeGreaterThanOrEqualTo(20);  // 创建条件对象</span></span><br><span class="line"><span class="comment">        example.or().andGenderEqualTo(&quot;男&quot;); // 上一句会和这一句以 or 连接</span></span><br><span class="line"><span class="comment">        List&lt;Emp&gt; list = mapper.selectByExample(example);</span></span><br><span class="line"><span class="comment">        list.forEach(System.out::println);*/</span></span><br><span class="line"></span><br><span class="line">    <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>(<span class="number">1</span>, <span class="string">&quot;小黑&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;女&quot;</span>);</span><br><span class="line">    <span class="comment">// 4. 测试普通修改功能(即使给的要修改的属性为 null, 也会把 null 赋值给原来的数据)</span></span><br><span class="line">    <span class="comment">// mapper.updateByPrimaryKey(emp);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 测试选择性修改功能(如果给的要修改的属性为 null, 其不会更改原来的数据)</span></span><br><span class="line">    mapper.updateByPrimaryKeySelective(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="13-分页插件"><a href="#13-分页插件" class="headerlink" title="13. 分页插件"></a>13. 分页插件</h3><blockquote>
<p>sql 语句实现分页查询：<strong>limit index,pageSize</strong></p>
<p><strong>pageSize</strong>：每页显示的条数(已知)</p>
<p><strong>pageNum</strong>：当前页的页码(已知)</p>
<p><strong>index</strong>：当前页的<strong>起始索引</strong></p>
<p>由公式：<strong>index &#x3D; (pageNum - 1) * pageSize</strong></p>
<p>eg. 每页 4 条，当前是第 3 页 —&gt; 则 index &#x3D; 4 * (3 - 1) &#x3D; 8  —&gt; 此时的 sql 语句：limit 8,4</p>
<p><strong>count</strong>：当前的总记录数</p>
<p><strong>totalPage</strong>：总页数   </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">totalPage = count / pageSize;</span><br><span class="line"><span class="keyword">if</span> (count % pageSize != <span class="number">0</span>) &#123;</span><br><span class="line">    totalPage += <span class="number">1</span>；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="13-1-分页插件的使用步骤"><a href="#13-1-分页插件的使用步骤" class="headerlink" title="13.1 分页插件的使用步骤"></a>13.1 分页插件的使用步骤</h4><p>（1）<strong>添加依赖</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.pagehelper/pagehelper --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（2）<strong>配置分页插件</strong></p>
<blockquote>
<p><strong>在 MyBatis 的核心配置文件</strong>（mybatis-config.xml）中配置插件，注意位置在 typeAliases 和 environments 标签之间</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--配置分页插件--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>（3）<strong>测试分页功能</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 在查询功能里头实现分页</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在查询功能之前开启分页功能(此处表示查询第一页, 每页展示 4 条数据)</span></span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>,<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有数据</span></span><br><span class="line">    List&lt;Emp&gt; list = mapper.selectByExample(<span class="literal">null</span>);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="13-2-分页插件的使用-获取分页相关数据"><a href="#13-2-分页插件的使用-获取分页相关数据" class="headerlink" title="13.2 分页插件的使用(获取分页相关数据)"></a>13.2 分页插件的使用(获取分页相关数据)</h4><p>（1）通过<strong>查询之前 PageHelper.startPage(int pageNum, int pageSize) 获取对应对象并输出</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 获取分页相关数据(直接通过 page 对象输出)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetPageData</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在查询功能之前开启分页功能(此处表示查询第一页, 每页展示 4 条数据)</span></span><br><span class="line">    Page&lt;Object&gt; page = PageHelper.startPage(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有数据</span></span><br><span class="line">    List&lt;Emp&gt; list = mapper.selectByExample(<span class="literal">null</span>);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">    System.out.println(page);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* page 的输出为:</span></span><br><span class="line"><span class="comment">            Page&#123;count=true, pageNum=1, pageSize=4, startRow=0, endRow=4, </span></span><br><span class="line"><span class="comment">                total=30, pages=8, reasonable=false, pageSizeZero=false&#125;</span></span><br><span class="line"><span class="comment">                [Emp&#123;empId=1, empName=&#x27;aaa&#x27;, age=null, gender=&#x27;null&#x27;, deptId=null&#125;, </span></span><br><span class="line"><span class="comment">                 Emp&#123;empId=2, empName=&#x27;aa&#x27;, age=null, gender=&#x27;null&#x27;, deptId=null&#125;, </span></span><br><span class="line"><span class="comment">                 Emp&#123;empId=3, empName=&#x27;a&#x27;, age=null, gender=&#x27;null&#x27;, deptId=null&#125;, </span></span><br><span class="line"><span class="comment">                 Emp&#123;empId=4, empName=&#x27;a&#x27;, age=null, gender=&#x27;null&#x27;, deptId=null&#125;]</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>（2）<strong>通过获取 PageInfo 对象 获取数据</strong></p>
<blockquote>
<p>在<strong>查询获取list集合之后</strong>，使用PageInfo&lt;T&gt; pageInfo &#x3D; new PageInfo&lt;&gt;(List&lt;T&gt; list, intnavigatePages) <strong>获取分页相关所有数据</strong>，PageInfo 比 Page 获取的数据多些</p>
<ul>
<li>list：分页之后的数据</li>
<li>navigatePages：导航分页的页码数</li>
</ul>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">// 获取分页相关数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetPageInfo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionUtil.getSqlSession();</span><br><span class="line">    <span class="type">EmpMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(EmpMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在查询功能之前开启分页功能(此处表示查询第一页, 每页展示 4 条数据)</span></span><br><span class="line">    Page&lt;Object&gt; page = PageHelper.startPage(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询所有数据</span></span><br><span class="line">    List&lt;Emp&gt; list = mapper.selectByExample(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询功能之后可以通过 PageInfo 获取分页相关的所有数据</span></span><br><span class="line">    PageInfo&lt;Emp&gt; pageInfo = <span class="keyword">new</span> <span class="title class_">PageInfo</span>&lt;&gt;(list, <span class="number">5</span>);</span><br><span class="line">    list.forEach(System.out::println);</span><br><span class="line">    System.out.println(pageInfo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* pageInfo 的输出为: (其中 list 就是上面 page 的内容)</span></span><br><span class="line"><span class="comment">            PageInfo&#123;pageNum=1, pageSize=4, size=4, startRow=1, endRow=4, total=30, pages=8, </span></span><br><span class="line"><span class="comment">                    list=Page&#123;count=true, pageNum=1, pageSize=4, startRow=0, endRow=4, total=30, </span></span><br><span class="line"><span class="comment">                        pages=8, reasonable=false, pageSizeZero=false&#125;</span></span><br><span class="line"><span class="comment">                    [Emp&#123;empId=1, empName=&#x27;aaa&#x27;, age=null, gender=&#x27;null&#x27;, deptId=null&#125;, </span></span><br><span class="line"><span class="comment">                    Emp&#123;empId=2, empName=&#x27;aa&#x27;, age=null, gender=&#x27;null&#x27;, deptId=null&#125;, </span></span><br><span class="line"><span class="comment">                    Emp&#123;empId=3, empName=&#x27;a&#x27;, age=null, gender=&#x27;null&#x27;, deptId=null&#125;, </span></span><br><span class="line"><span class="comment">                    Emp&#123;empId=4, empName=&#x27;a&#x27;, age=null, gender=&#x27;null&#x27;, deptId=null&#125;], </span></span><br><span class="line"><span class="comment">                    prePage=0, nextPage=2, isFirstPage=true, isLastPage=false, hasPreviousPage=false, </span></span><br><span class="line"><span class="comment">                    hasNextPage=true, navigatePages=5, navigateFirstPage=1, navigateLastPage=5, </span></span><br><span class="line"><span class="comment">                    navigatepageNums=[1, 2, 3, 4, 5]&#125;</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>常用数据：</p>
<p>pageNum：当前页的页码</p>
<p>pageSize：每页显示的条数</p>
<p>size：当前页显示的真实条数</p>
<p>total：总记录数</p>
<p>pages：总页数</p>
<p>prePage：上一页的页码</p>
<p>nextPage：下一页的页码</p>
<p>isFirstPage&#x2F;isLastPage：是否为第一页&#x2F;最后一页</p>
<p>hasPreviousPage&#x2F;hasNextPage：是否存在上一页&#x2F;下一页</p>
<p>navigatePages：导航分页的页码数</p>
<p>navigatepageNums：导航分页的页码，[1,2,3,4,5]</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://tangsmallrong.github.io">thr</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://tangsmallrong.github.io/2023/11/18/MyBatis/">https://tangsmallrong.github.io/2023/11/18/MyBatis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://tangsmallrong.github.io" target="_blank">thr's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/mybatis/">mybatis</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/18/Awk/" title="awk 编程"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">awk 编程</div></div></a></div><div class="next-post pull-right"><a href="/2023/11/18/Spider/" title="爬虫"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">爬虫</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81MyBatis"><span class="toc-text">一、MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-MyBatis-%E7%AE%80%E4%BB%8B"><span class="toc-text">1. MyBatis 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-MyBatis-%E5%8E%86%E5%8F%B2"><span class="toc-text">1.1 MyBatis 历史</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-MyBatis-%E7%89%B9%E6%80%A7"><span class="toc-text">1.2 MyBatis 特性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-MyBatis-%E4%B8%8B%E8%BD%BD"><span class="toc-text">1.3 MyBatis 下载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%92%8C%E5%85%B6%E5%AE%83%E7%9A%84%E6%8C%81%E4%B9%85%E5%B1%82%E6%8A%80%E6%9C%AF%E5%AF%B9%E6%AF%94"><span class="toc-text">1.4 和其它的持久层技术对比</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%90%AD%E5%BB%BA-MyBatis"><span class="toc-text">2. 搭建 MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-text">2.1 开发环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%88%9B%E5%BB%BA-maven-%E5%B7%A5%E7%A8%8B"><span class="toc-text">2.2 创建 maven 工程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E5%88%9B%E5%BB%BA-MyBatis-%E7%9A%84%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-text">2.3 创建 MyBatis 的核心配置文件夹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%88%9B%E5%BB%BA-mapper-%E6%8E%A5%E5%8F%A3"><span class="toc-text">2.4 创建 mapper 接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E5%88%9B%E5%BB%BA-MyBatis-%E7%9A%84%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="toc-text">2.5 创建 MyBatis 的映射文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-%E9%80%9A%E8%BF%87-junit-%E6%B5%8B%E8%AF%95%E5%8A%9F%E8%83%BD"><span class="toc-text">2.6 通过 junit 测试功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-7-%E5%8A%A0%E5%85%A5-log4j-%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD"><span class="toc-text">2.7 加入 log4j 日志功能</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-MyBatis-%E7%9A%84-%E5%A2%9E-%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-text">3. MyBatis 的(增)删改查</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%88%9B%E5%BB%BA%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">3.1 创建工具类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-Update"><span class="toc-text">3.2 Update</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-Delete"><span class="toc-text">3.3 Delete</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-Retrieve"><span class="toc-text">3.4 Retrieve</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-MyBatis-%E7%9A%84%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%A6%E8%A7%A3"><span class="toc-text">4. MyBatis 的核心配置文件详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-environments-%E6%A0%87%E7%AD%BE"><span class="toc-text">4.1 environments 标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-properties-%E6%A0%87%E7%AD%BE"><span class="toc-text">4.2 properties 标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-typeAliases-%E6%A0%87%E7%AD%BE"><span class="toc-text">4.3 typeAliases 标签</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-mappers-%E6%A0%87%E7%AD%BE"><span class="toc-text">4.4 mappers 标签</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AE%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%92%8C%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6%E6%A8%A1%E6%9D%BF"><span class="toc-text">5. 配置核心配置文件和映射文件模板</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E9%85%8D%E7%BD%AE%E6%A8%A1%E6%9D%BF"><span class="toc-text">5.1 配置模板</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF"><span class="toc-text">5.2 使用模板</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-MyBatis-%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E5%80%BC%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-text">6. MyBatis 获取参数值的两种方式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E5%8D%95%E4%B8%AA%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-text">6.1 单个字面量类型的参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E5%A4%9A%E4%B8%AA%E5%AD%97%E9%9D%A2%E9%87%8F%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-text">6.2 多个字面量类型的参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-map-%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-text">6.3 map 集合类型的参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-%E5%AE%9E%E4%BD%93%E7%B1%BB%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-text">6.4 实体类类型的参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-5-%E4%BD%BF%E7%94%A8-Param-%E6%A0%87%E8%AF%86%E5%8F%82%E6%95%B0"><span class="toc-text">6.5 使用 @Param 标识参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-6-%E6%80%BB%E7%BB%93"><span class="toc-text">6.6 总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-MyBatis-%E7%9A%84%E5%90%84%E7%A7%8D%E6%9F%A5%E8%AF%A2%E5%8A%9F%E8%83%BD"><span class="toc-text">7. MyBatis 的各种查询功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BD%93%E7%B1%BB%E5%AF%B9%E8%B1%A1"><span class="toc-text">7.1 查询一个实体类对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E6%9F%A5%E8%AF%A2%E4%B8%80%E4%B8%AA-list-%E9%9B%86%E5%90%88"><span class="toc-text">7.2 查询一个 list 集合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-%E6%9F%A5%E8%AF%A2%E5%8D%95%E4%B8%AA%E6%95%B0%E6%8D%AE"><span class="toc-text">7.3 查询单个数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-%E6%9F%A5%E8%AF%A2%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE%E4%B8%BA-map-%E9%9B%86%E5%90%88"><span class="toc-text">7.4 查询一条数据为 map 集合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-5-%E6%9F%A5%E8%AF%A2%E5%A4%9A%E6%9D%A1%E6%95%B0%E6%8D%AE%E4%B8%BA-map-%E9%9B%86%E5%90%88"><span class="toc-text">7.5 查询多条数据为 map 集合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E7%89%B9%E6%AE%8A-SQL-%E7%9A%84%E6%89%A7%E8%A1%8C"><span class="toc-text">8. 特殊 SQL 的执行</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-text">8.1 模糊查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-text">8.2 批量删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-%E5%8A%A8%E6%80%81%E8%AE%BE%E7%BD%AE%E8%A1%A8%E5%90%8D"><span class="toc-text">8.3 动态设置表名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-%E6%B7%BB%E5%8A%A0%E5%8A%9F%E8%83%BD%E8%8E%B7%E5%8F%96%E8%87%AA%E5%A2%9E%E7%9A%84%E4%B8%BB%E9%94%AE-%E5%B8%B8%E7%94%A8%EF%BC%81%E9%9A%BE%E7%90%86%E8%A7%A3"><span class="toc-text">8.4 添加功能获取自增的主键(常用！难理解)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%A0%E5%B0%84-resultMap"><span class="toc-text">9. 自定义映射 resultMap</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-0-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">9.0 准备工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-resultMap-%E5%A4%84%E7%90%86%E5%AD%97%E6%AE%B5%E5%92%8C%E5%B1%9E%E6%80%A7%E7%9A%84%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB-%E5%AD%97%E6%AE%B5%E5%92%8C%E5%B1%9E%E6%80%A7%E5%90%8D%E4%B8%8D%E4%B8%80%E8%87%B4"><span class="toc-text">9.1 resultMap 处理字段和属性的映射关系(字段和属性名不一致)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-%E5%A4%9A%E5%AF%B9%E4%B8%80%E6%98%A0%E5%B0%84%E5%A4%84%E7%90%86"><span class="toc-text">9.2 多对一映射处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-%E4%B8%80%E5%AF%B9%E5%A4%9A%E6%98%A0%E5%B0%84%E5%A4%84%E7%90%86"><span class="toc-text">9.3 一对多映射处理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E5%8A%A8%E6%80%81-SQL"><span class="toc-text">10. 动态 SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-if"><span class="toc-text">10.1 if</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-2-where"><span class="toc-text">10.2 where</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-3-trim"><span class="toc-text">10.3 trim</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-4-choose%E3%80%81when%E3%80%81otherwise"><span class="toc-text">10.4 choose、when、otherwise</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-5-foreach-%E9%87%8D%E8%A6%81"><span class="toc-text">10.5 foreach(重要)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-6-SQL-%E7%89%87%E6%AE%B5"><span class="toc-text">10.6 SQL 片段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-MyBatis-%E7%9A%84%E7%BC%93%E5%AD%98"><span class="toc-text">11. MyBatis 的缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1-MyBatis-%E7%9A%84%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">11.1 MyBatis 的一级缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-MyBatis-%E7%9A%84%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">11.2 MyBatis 的二级缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-3-%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E7%9A%84%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-text">11.3 二级缓存的相关配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-MyBatis-%E7%BC%93%E5%AD%98%E6%9F%A5%E8%AF%A2%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="toc-text">11.4 MyBatis 缓存查询的顺序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-5-%E6%95%B4%E5%90%88%E7%AC%AC%E4%B8%89%E6%96%B9%E7%BC%93%E5%AD%98-EHCache-%E4%BA%86%E8%A7%A3%E5%8D%B3%E5%8F%AF"><span class="toc-text">11.5 整合第三方缓存 EHCache(了解即可)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-MyBatis-%E7%9A%84%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="toc-text">12. MyBatis 的逆向工程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#12-1-%E5%88%9B%E5%BB%BA%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E7%9A%84%E6%AD%A5%E9%AA%A4-%E7%AE%80%E6%B4%81%E7%89%88"><span class="toc-text">12.1 创建逆向工程的步骤(简洁版)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-2-%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B-MyBatis3-%E7%94%9F%E6%88%90%E7%9A%84%E6%96%B9%E6%B3%95%E8%AF%B4%E6%98%8E-%E5%A5%A2%E5%8D%8E%E7%89%88"><span class="toc-text">12.2 逆向工程 MyBatis3 生成的方法说明(奢华版)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-text">13. 分页插件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#13-1-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="toc-text">13.1 分页插件的使用步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-2-%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8-%E8%8E%B7%E5%8F%96%E5%88%86%E9%A1%B5%E7%9B%B8%E5%85%B3%E6%95%B0%E6%8D%AE"><span class="toc-text">13.2 分页插件的使用(获取分页相关数据)</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By thr</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>